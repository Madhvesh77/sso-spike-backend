[
  {
    "id": "1cb94c7c-28ec-42c8-8692-025671e4bb11",
    "timestamp": 1763375051612,
    "type": "completion",
    "prompt": "",
    "response": "\n    return required_role in roles if roles else False",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 54
  },
  {
    "id": "8b28c9ff-84b5-454f-8c35-74a446b32eb7",
    "timestamp": 1763375051618,
    "type": "completion",
    "prompt": "",
    "response": "\n        roles = claims.get(\"groups\", [])  # Group memberships",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 62
  },
  {
    "id": "73caf772-bbef-4ae5-ac10-f52361dd0c93",
    "timestamp": 1763375051756,
    "type": "completion",
    "prompt": "",
    "response": "\n    roles = claims.get(\"roles\", [])  # App roles",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 49
  },
  {
    "id": "48af151b-d378-4cd8-9065-8782155da73b",
    "timestamp": 1763375051763,
    "type": "completion",
    "prompt": "",
    "response": "\n    # Roles can be in different claim types depending on token type",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 68
  },
  {
    "id": "1f251dcf-a940-4545-81d3-9ce6cad55d62",
    "timestamp": 1763375051768,
    "type": "completion",
    "prompt": "",
    "response": "\n        True if user has the required role, False otherwise",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 60
  },
  {
    "id": "dac6b208-b47f-48ce-826b-cdae45d1255f",
    "timestamp": 1763375051769,
    "type": "completion",
    "prompt": "",
    "response": "\n        required_role: The role to check for",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 45
  },
  {
    "id": "02aeb42f-ee8e-41be-88d2-114c134932a3",
    "timestamp": 1763375051783,
    "type": "completion",
    "prompt": "",
    "response": "\n        claims: Decoded JWT claims",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 35
  },
  {
    "id": "7dc1da38-1f10-4454-91d3-8772326159fc",
    "timestamp": 1763375051791,
    "type": "completion",
    "prompt": "",
    "response": "\n    Check if the user has a required role in their JWT claims.",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 63
  },
  {
    "id": "3b97d2cc-fdab-4fee-89a5-67a7ae686b5d",
    "timestamp": 1763375051849,
    "type": "completion",
    "prompt": "",
    "response": "\ndef has_required_role(claims: Dict[str, Any], required_role: str) -> bool:",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 75
  },
  {
    "id": "143aadf1-af2b-49ea-8b2d-4a68bcce7595",
    "timestamp": 1763375051866,
    "type": "completion",
    "prompt": "",
    "response": "\n        raise Exception(f\"Token verification error: {str(e)}\")",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 63
  },
  {
    "id": "a3a13082-c0bb-4fe3-ade1-589591572d3d",
    "timestamp": 1763375051870,
    "type": "completion",
    "prompt": "",
    "response": "\n    except Exception as e:",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 27
  },
  {
    "id": "6cbd1ddd-3e05-46df-8022-de9300493562",
    "timestamp": 1763375051871,
    "type": "completion",
    "prompt": "",
    "response": "\n        raise Exception(f\"Token validation failed: {str(e)}\")",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 62
  },
  {
    "id": "518da3f0-b18a-4919-b7c7-a8b7e4cf5378",
    "timestamp": 1763375051876,
    "type": "completion",
    "prompt": "",
    "response": "\n    except JWTError as e:",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 26
  },
  {
    "id": "95b3f9e3-5ad2-49b8-990c-2be76e0328e0",
    "timestamp": 1763375051877,
    "type": "completion",
    "prompt": "",
    "response": "\n        raise Exception(f\"Token claims validation failed: {str(e)}\")",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 69
  },
  {
    "id": "911f2f23-e940-41ac-b689-d007924683d0",
    "timestamp": 1763375051882,
    "type": "completion",
    "prompt": "",
    "response": "\n    except JWTClaimsError as e:",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 32
  },
  {
    "id": "d42e8681-42be-4a0c-adf0-b2abe1368800",
    "timestamp": 1763375051884,
    "type": "completion",
    "prompt": "",
    "response": "\n        raise Exception(\"Token has expired\")",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 45
  },
  {
    "id": "08bb6ade-1af8-4aeb-8f51-6f2fcb41be84",
    "timestamp": 1763375051889,
    "type": "completion",
    "prompt": "",
    "response": "\n    except ExpiredSignatureError:",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 34
  },
  {
    "id": "4b53cf90-8f42-4522-8c63-a0d7b775fe53",
    "timestamp": 1763375051890,
    "type": "completion",
    "prompt": "",
    "response": "\n        return decoded_token",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 29
  },
  {
    "id": "0a3989af-6859-49f6-9492-689ce96aa4e3",
    "timestamp": 1763375051896,
    "type": "completion",
    "prompt": "",
    "response": "\n                \"require_exp\": True",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 36
  },
  {
    "id": "e4d2a407-a7c5-4f92-af25-9f5fd8628977",
    "timestamp": 1763375051897,
    "type": "completion",
    "prompt": "",
    "response": "\n                \"require_iss\": True,",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 37
  },
  {
    "id": "1927641a-d741-4c58-9f14-8edcad8fbe34",
    "timestamp": 1763375051898,
    "type": "completion",
    "prompt": "",
    "response": "\n                \"require_aud\": True,",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 37
  },
  {
    "id": "26418efa-d8d2-4fe3-8f40-e86c68f9bcec",
    "timestamp": 1763375051913,
    "type": "completion",
    "prompt": "",
    "response": "\n                \"verify_iat\": True,",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 36
  },
  {
    "id": "7f3f1113-f7b9-4b3a-90d1-231c65f94a3b",
    "timestamp": 1763375051919,
    "type": "completion",
    "prompt": "",
    "response": "\n                \"verify_nbf\": True,",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 36
  },
  {
    "id": "79b5c70e-a2ce-4e35-8725-8d05be436ffb",
    "timestamp": 1763375051926,
    "type": "completion",
    "prompt": "",
    "response": "\n                \"verify_exp\": True,",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 36
  },
  {
    "id": "f18f6fe4-0578-4bc1-a8cc-39141a7b3602",
    "timestamp": 1763375051927,
    "type": "completion",
    "prompt": "",
    "response": "\n                \"verify_iss\": True,",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 36
  },
  {
    "id": "0b6ce60c-8164-4910-b33e-3ff3d580a4ff",
    "timestamp": 1763375051931,
    "type": "completion",
    "prompt": "",
    "response": "\n                \"verify_aud\": True,",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 36
  },
  {
    "id": "1dbc682a-bc37-480b-887d-48b638817c0f",
    "timestamp": 1763375051931,
    "type": "completion",
    "prompt": "",
    "response": "\n                \"verify_signature\": True,",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 42
  },
  {
    "id": "2e8b58f9-76d8-4539-9974-12197ddae6ab",
    "timestamp": 1763375051935,
    "type": "completion",
    "prompt": "",
    "response": "\n            options={",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 22
  },
  {
    "id": "f0013468-9b3a-450f-8370-9536b76d1ada",
    "timestamp": 1763375051936,
    "type": "completion",
    "prompt": "",
    "response": "\n            issuer=expected_issuer,",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 36
  },
  {
    "id": "63527585-ad68-4187-a089-12d3dd63bc2a",
    "timestamp": 1763375051942,
    "type": "completion",
    "prompt": "",
    "response": "\n            audience=api_audience,",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 35
  },
  {
    "id": "a163b8b0-4dda-4c59-80a4-5edbf61a79da",
    "timestamp": 1763375051943,
    "type": "completion",
    "prompt": "",
    "response": "\n            algorithms=[\"RS256\"],",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 34
  },
  {
    "id": "57b7ee69-c922-4f11-99eb-590e9105da70",
    "timestamp": 1763375051947,
    "type": "completion",
    "prompt": "",
    "response": "\n            signing_key,",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 25
  },
  {
    "id": "5dd86b83-6d52-4ffa-933d-c53b75bd5429",
    "timestamp": 1763375051948,
    "type": "completion",
    "prompt": "",
    "response": "\n        decoded_token = jwt.decode(",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 36
  },
  {
    "id": "81de17f5-a9b8-45c6-a22c-2912bcc81a76",
    "timestamp": 1763375051952,
    "type": "completion",
    "prompt": "",
    "response": "\n        expected_issuer = f\"https://login.microsoftonline.com/{tenant_id}/v2.0\"",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 80
  },
  {
    "id": "42ba1cf8-f6fe-4fb7-b333-5af5a7de2f41",
    "timestamp": 1763375051953,
    "type": "completion",
    "prompt": "",
    "response": "\n        # Expected issuer for Azure AD v2.0 tokens",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 51
  },
  {
    "id": "3eef2220-9ab1-4cfe-82c9-d659743755c9",
    "timestamp": 1763375051957,
    "type": "completion",
    "prompt": "",
    "response": "\n        # Verify and decode the token",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 38
  },
  {
    "id": "aa436d34-6c65-4596-aad1-205b9c07a016",
    "timestamp": 1763375051958,
    "type": "completion",
    "prompt": "",
    "response": "\n            raise Exception(f\"Signing key not found for kid: {kid}\")",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 69
  },
  {
    "id": "fbaa3873-0239-4dd4-ab38-9f59ada767f0",
    "timestamp": 1763375051961,
    "type": "completion",
    "prompt": "",
    "response": "\n        if not signing_key:",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 28
  },
  {
    "id": "d62dc4c9-b30a-4693-a453-714786552a05",
    "timestamp": 1763375051962,
    "type": "completion",
    "prompt": "",
    "response": "\n        signing_key = get_signing_key(jwks, kid)",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 49
  },
  {
    "id": "8932e391-db38-4fea-9091-e6de1bd6f438",
    "timestamp": 1763375051966,
    "type": "completion",
    "prompt": "",
    "response": "\n        # Get the signing key",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 30
  },
  {
    "id": "2aa398b8-6878-4422-af98-1853185ddc66",
    "timestamp": 1763375051966,
    "type": "completion",
    "prompt": "",
    "response": "\n        jwks = await fetch_jwks(tenant_id)",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 43
  },
  {
    "id": "3270b63b-78d7-49c2-bf1b-ee2a1a920fc3",
    "timestamp": 1763375051970,
    "type": "completion",
    "prompt": "",
    "response": "\n        # Fetch JWKS from Microsoft",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 36
  },
  {
    "id": "a5c2ecb4-1e82-488c-b6f3-2731188cc2a4",
    "timestamp": 1763375051971,
    "type": "completion",
    "prompt": "",
    "response": "\n            raise Exception(\"Token header missing 'kid' (Key ID)\")",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 67
  },
  {
    "id": "b2c2db9a-8482-4478-ad2b-f9c1c7cc5d6a",
    "timestamp": 1763375051974,
    "type": "completion",
    "prompt": "",
    "response": "\n        kid = unverified_header.get(\"kid\")",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 43
  },
  {
    "id": "58902f70-b324-4c8f-92cc-92bb84d9c04e",
    "timestamp": 1763375051975,
    "type": "completion",
    "prompt": "",
    "response": "\n        unverified_header = jwt.get_unverified_header(token)",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 61
  },
  {
    "id": "e37200e8-a623-4a58-b10e-ae4a605f32a9",
    "timestamp": 1763375051979,
    "type": "completion",
    "prompt": "",
    "response": "\n        # Decode the token header to get the key ID",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 52
  },
  {
    "id": "9da82448-9f54-45dd-ac52-aaa514d95874",
    "timestamp": 1763375051979,
    "type": "completion",
    "prompt": "",
    "response": "\n        raise Exception(\"API_AUDIENCE (or CLIENT_ID) environment variable is required\")",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 88
  },
  {
    "id": "621c078f-d508-455a-a85c-0ddcd7f567ff",
    "timestamp": 1763375051983,
    "type": "completion",
    "prompt": "",
    "response": "\n    if not api_audience:",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 25
  },
  {
    "id": "44f43dba-2510-4f1b-9f18-245573567d35",
    "timestamp": 1763375051984,
    "type": "completion",
    "prompt": "",
    "response": "\n        raise Exception(\"TENANT_ID environment variable is required\")",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 70
  },
  {
    "id": "60f27189-03de-4991-91b4-7b842850bef9",
    "timestamp": 1763375051992,
    "type": "completion",
    "prompt": "",
    "response": "\n    if not tenant_id:",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 22
  },
  {
    "id": "fd37d0a0-b4b3-414c-adfa-35fedff81f9e",
    "timestamp": 1763375051993,
    "type": "completion",
    "prompt": "",
    "response": "\n    api_audience = os.getenv(\"API_AUDIENCE\") or os.getenv(\"CLIENT_ID\")",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 71
  },
  {
    "id": "7d696433-f61f-4047-9eba-aa4826b5bed8",
    "timestamp": 1763375051997,
    "type": "completion",
    "prompt": "",
    "response": "\n    tenant_id = os.getenv(\"TENANT_ID\")",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 39
  },
  {
    "id": "85c03ff4-88e1-412e-b3f3-d6b0e2e07632",
    "timestamp": 1763375051998,
    "type": "completion",
    "prompt": "",
    "response": "\n    # Get configuration from environment variables",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 51
  },
  {
    "id": "30728686-07e1-4863-a8a5-f59aa429646b",
    "timestamp": 1763375052003,
    "type": "completion",
    "prompt": "",
    "response": "\n        Exception: If token is invalid, expired, or verification fails",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 71
  },
  {
    "id": "43f17b65-88be-4817-9a34-36528057850f",
    "timestamp": 1763375052004,
    "type": "completion",
    "prompt": "",
    "response": "\n        Decoded JWT claims",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 27
  },
  {
    "id": "65a962fb-f737-49f0-81e8-a4ca9b922a47",
    "timestamp": 1763375052010,
    "type": "completion",
    "prompt": "",
    "response": "\n        token: The JWT token to verify",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 39
  },
  {
    "id": "33247169-103f-448a-8a77-da6533c8c41f",
    "timestamp": 1763375052011,
    "type": "completion",
    "prompt": "",
    "response": "\n    Verify and decode a JWT token from Microsoft Entra ID.",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 59
  },
  {
    "id": "42e3f099-8dec-4956-b1f0-4707d1a8f911",
    "timestamp": 1763375052015,
    "type": "completion",
    "prompt": "",
    "response": "\nasync def verify_jwt(token: str) -> Dict[str, Any]:",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 52
  },
  {
    "id": "79fa6e95-7a97-4193-b63d-82959ca8f1fe",
    "timestamp": 1763375052015,
    "type": "completion",
    "prompt": "",
    "response": "\n                return key",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 27
  },
  {
    "id": "58ad2f96-0e38-492f-94c1-577f879c6ed3",
    "timestamp": 1763375052018,
    "type": "completion",
    "prompt": "",
    "response": "\n            if key.get(\"kty\") == \"RSA\":",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 40
  },
  {
    "id": "89b4a006-ba21-4924-8133-c33b84d7f40a",
    "timestamp": 1763375052019,
    "type": "completion",
    "prompt": "",
    "response": "\n            # Return the key in PEM format for RSA keys",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 56
  },
  {
    "id": "d37fb9f1-5627-433d-9786-508a136806a4",
    "timestamp": 1763375052026,
    "type": "completion",
    "prompt": "",
    "response": "\n        if key.get(\"kid\") == kid:",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 34
  },
  {
    "id": "7b277f21-d3b1-4b65-baaa-9ce4600360f4",
    "timestamp": 1763375052027,
    "type": "completion",
    "prompt": "",
    "response": "\n    for key in jwks.get(\"keys\", []):",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 37
  },
  {
    "id": "1db4610d-76b2-4e4a-967e-a7cb9314b1a1",
    "timestamp": 1763375052030,
    "type": "completion",
    "prompt": "",
    "response": "\n        The signing key or None if not found",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 45
  },
  {
    "id": "9f7a6501-25d6-45e6-8e62-3161433c8072",
    "timestamp": 1763375052031,
    "type": "completion",
    "prompt": "",
    "response": "\n        kid: Key ID from the JWT header",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 40
  },
  {
    "id": "ca03122a-fc29-498c-ba2c-4dd51a8e4f71",
    "timestamp": 1763375052034,
    "type": "completion",
    "prompt": "",
    "response": "\n        jwks: The JSON Web Key Set",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 35
  },
  {
    "id": "8c18a8b9-3470-46dd-b1e1-fa760a2d6582",
    "timestamp": 1763375052034,
    "type": "completion",
    "prompt": "",
    "response": "\n    Extract the signing key from JWKS for a given key ID.",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 58
  },
  {
    "id": "a21444b3-d119-457d-a065-567478024ec7",
    "timestamp": 1763375052037,
    "type": "completion",
    "prompt": "",
    "response": "\ndef get_signing_key(jwks: Dict[str, Any], kid: str) -> Optional[str]:",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 70
  },
  {
    "id": "db2c926d-1486-449d-9d12-06bed82a3a53",
    "timestamp": 1763375052038,
    "type": "completion",
    "prompt": "",
    "response": "\n            raise Exception(f\"Failed to fetch JWKS: {str(e)}\")",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 63
  },
  {
    "id": "c65a6856-d5c9-46b8-a5fb-e5ebaec5be4f",
    "timestamp": 1763375052041,
    "type": "completion",
    "prompt": "",
    "response": "\n        except httpx.HTTPError as e:",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 37
  },
  {
    "id": "19a14399-0e10-4b36-9998-d76723e89fca",
    "timestamp": 1763375052041,
    "type": "completion",
    "prompt": "",
    "response": "\n            return jwks",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 24
  },
  {
    "id": "969faf03-9723-4f47-8aca-e1eba3e43bb8",
    "timestamp": 1763375052046,
    "type": "completion",
    "prompt": "",
    "response": "\n            jwks_cache[\"jwks\"] = jwks",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 38
  },
  {
    "id": "240483e9-2890-4451-99a9-dbc407d85596",
    "timestamp": 1763375052046,
    "type": "completion",
    "prompt": "",
    "response": "\n            # Cache the JWKS for 1 hour",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 40
  },
  {
    "id": "d01cf771-5861-461c-b395-f8d2cc4f7ac7",
    "timestamp": 1763375052049,
    "type": "completion",
    "prompt": "",
    "response": "\n            jwks = response.json()",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 35
  },
  {
    "id": "e22b280b-c316-4a60-937f-a6d14eda7026",
    "timestamp": 1763375052050,
    "type": "completion",
    "prompt": "",
    "response": "\n            response.raise_for_status()",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 40
  },
  {
    "id": "7c61138a-9e58-44b4-ad3c-383170958330",
    "timestamp": 1763375052050,
    "type": "completion",
    "prompt": "",
    "response": "\n            response = await client.get(jwks_url)",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 50
  },
  {
    "id": "648d4d8b-8d46-4cb4-b48b-1f3d26b70f83",
    "timestamp": 1763375052054,
    "type": "completion",
    "prompt": "",
    "response": "\n    async with httpx.AsyncClient() as client:",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 46
  },
  {
    "id": "5a3643aa-f3bc-42df-91f4-7bdb5122797b",
    "timestamp": 1763375052054,
    "type": "completion",
    "prompt": "",
    "response": "\n        return jwks_cache[\"jwks\"]",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 34
  },
  {
    "id": "c9b2b1fd-ae30-4068-9fb0-6c2f45d1cfdb",
    "timestamp": 1763375052058,
    "type": "completion",
    "prompt": "",
    "response": "\n    if \"jwks\" in jwks_cache:",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 29
  },
  {
    "id": "266300d5-54cd-4260-a4cc-1f6d7de1465d",
    "timestamp": 1763375052058,
    "type": "completion",
    "prompt": "",
    "response": "\n    # Check cache first",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 24
  },
  {
    "id": "5553d38a-166e-4e54-bbfb-77241cc62d7a",
    "timestamp": 1763375052062,
    "type": "completion",
    "prompt": "",
    "response": "\n    jwks_url = f\"https://login.microsoftonline.com/{tenant_id}/discovery/v2.0/keys\"",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 84
  },
  {
    "id": "9a4ae761-b7cb-40bb-a66e-663daff0ac35",
    "timestamp": 1763375052062,
    "type": "completion",
    "prompt": "",
    "response": "\n        Dictionary containing the JWKS",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 39
  },
  {
    "id": "c003c64e-21f1-426b-ac11-b4d2372a4172",
    "timestamp": 1763375052066,
    "type": "completion",
    "prompt": "",
    "response": "\n        tenant_id: The Azure AD tenant ID",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 42
  },
  {
    "id": "df2831ee-04df-4bb4-bb99-90e10d284338",
    "timestamp": 1763375052066,
    "type": "completion",
    "prompt": "",
    "response": "\n    Fetch JWKS (JSON Web Key Set) from Microsoft Entra ID discovery endpoint.",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 78
  },
  {
    "id": "584a4ee5-c5e4-4ca4-8fd4-bb8688161d60",
    "timestamp": 1763375052071,
    "type": "completion",
    "prompt": "",
    "response": "\nasync def fetch_jwks(tenant_id: str) -> Dict[str, Any]:",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 56
  },
  {
    "id": "fb65a2c3-c13b-4a18-abbb-674e9644a0c9",
    "timestamp": 1763375052073,
    "type": "completion",
    "prompt": "",
    "response": "\njwks_cache = TTLCache(maxsize=1, ttl=3600)",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 43
  },
  {
    "id": "28159dd9-f153-49cb-8ba4-17c7e640cfc4",
    "timestamp": 1763375052086,
    "type": "completion",
    "prompt": "",
    "response": "\n# Cache for storing JWKS keys (Time-To-Live cache with 1 hour expiration)",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 74
  },
  {
    "id": "d1a050b2-1c65-4740-9b33-e80ee0993377",
    "timestamp": 1763375052088,
    "type": "completion",
    "prompt": "",
    "response": "\nfrom jose.exceptions import ExpiredSignatureError, JWTClaimsError",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 66
  },
  {
    "id": "990ea6a2-bd5c-4118-aec9-45011638202d",
    "timestamp": 1763375052092,
    "type": "completion",
    "prompt": "",
    "response": "\nfrom jose import jwt, JWTError",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 31
  },
  {
    "id": "cf62b8ad-fd4d-459a-ae0e-8ce90d994a99",
    "timestamp": 1763375052093,
    "type": "completion",
    "prompt": "",
    "response": "\nfrom cachetools import TTLCache",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 32
  },
  {
    "id": "ea4f0940-6ad4-488e-8b99-be43bd8b93bb",
    "timestamp": 1763375052097,
    "type": "completion",
    "prompt": "",
    "response": "\nfrom typing import Dict, Any, Optional",
    "language": "python",
    "filePath": "auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 39
  },
  {
    "id": "af66b999-d1a5-4d43-a21e-a25af942316a",
    "timestamp": 1763375072527,
    "type": "completion",
    "prompt": "",
    "response": "\n    uvicorn.run(app, host=\"0.0.0.0\", port=8000, reload=True)",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 61
  },
  {
    "id": "c7e7931a-49d4-4f0a-b589-e2aec37316f6",
    "timestamp": 1763375072532,
    "type": "completion",
    "prompt": "",
    "response": "\nif __name__ == \"__main__\":",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 27
  },
  {
    "id": "cd9907f4-dedf-44c8-8977-1082b767d18f",
    "timestamp": 1763375072549,
    "type": "completion",
    "prompt": "",
    "response": "\n        detail=\"Internal server error\"",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 39
  },
  {
    "id": "6eff6a0c-2921-4806-9b6e-f20f4d20ef54",
    "timestamp": 1763375072552,
    "type": "completion",
    "prompt": "",
    "response": "\n        status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 59
  },
  {
    "id": "420e3648-d800-41ce-8032-5ceadb22bfb5",
    "timestamp": 1763375072557,
    "type": "completion",
    "prompt": "",
    "response": "\n    return HTTPException(",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 26
  },
  {
    "id": "3f871165-131f-469f-81bb-cb8493134369",
    "timestamp": 1763375072558,
    "type": "completion",
    "prompt": "",
    "response": "\n    logger.error(f\"Unhandled exception: {str(exc)}\")",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 53
  },
  {
    "id": "d9d8a22b-aa7c-4cb4-855f-239e164ee2a6",
    "timestamp": 1763375072564,
    "type": "completion",
    "prompt": "",
    "response": "\n    Global exception handler for unhandled exceptions.",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 55
  },
  {
    "id": "dbf33967-13d7-4991-9c51-87d9fbf48575",
    "timestamp": 1763375072565,
    "type": "completion",
    "prompt": "",
    "response": "\nasync def global_exception_handler(request, exc):",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 50
  },
  {
    "id": "6c3b8aa3-0647-4f52-8482-c00c3a0c163f",
    "timestamp": 1763375072572,
    "type": "completion",
    "prompt": "",
    "response": "\n@app.exception_handler(Exception)",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 34
  },
  {
    "id": "7fa35f59-1c36-4b1a-ac7e-17be28d869b7",
    "timestamp": 1763375072573,
    "type": "completion",
    "prompt": "",
    "response": "\n            \"permissions\": [\"read\", \"write\", \"delete\", \"approve\"]",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 66
  },
  {
    "id": "324876aa-b182-477e-8f21-e25055bb31ac",
    "timestamp": 1763375072574,
    "type": "completion",
    "prompt": "",
    "response": "\n            \"access_level\": \"administrator\",",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 45
  },
  {
    "id": "9bbb8684-da5f-4970-959a-a6d9c122ccf1",
    "timestamp": 1763375072578,
    "type": "completion",
    "prompt": "",
    "response": "\n        \"admin_info\": {",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 24
  },
  {
    "id": "6d132e7e-33c7-4376-804e-e50b4f8f5420",
    "timestamp": 1763375072579,
    "type": "completion",
    "prompt": "",
    "response": "\n            \"roles\": current_user.get(\"roles\", [])",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 51
  },
  {
    "id": "f9cec153-d4db-4122-ba9d-9ed7f5175c47",
    "timestamp": 1763375072584,
    "type": "completion",
    "prompt": "",
    "response": "\n            \"name\": current_user.get(\"name\"),",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 46
  },
  {
    "id": "cd25f47a-d6ad-4697-9a2f-b5359b70d1ec",
    "timestamp": 1763375072584,
    "type": "completion",
    "prompt": "",
    "response": "\n            \"email\": current_user.get(\"email\") or current_user.get(\"preferred_username\"),",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 90
  },
  {
    "id": "f205cbe2-5e4f-43d1-97c4-a604191b2a05",
    "timestamp": 1763375072589,
    "type": "completion",
    "prompt": "",
    "response": "\n        \"message\": \"Welcome to the admin area!\",",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 49
  },
  {
    "id": "bd7464d3-b9a5-4c7f-9ba4-7eb3384e74a7",
    "timestamp": 1763375072590,
    "type": "completion",
    "prompt": "",
    "response": "\n        Admin-specific information",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 35
  },
  {
    "id": "584c8d8f-49d5-4c39-8ad8-60247de90962",
    "timestamp": 1763375072594,
    "type": "completion",
    "prompt": "",
    "response": "\n        current_user: Authenticated user claims (must have \"approver\" role)",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 76
  },
  {
    "id": "607fc4f0-8b50-4047-9903-1a5a6a192ea5",
    "timestamp": 1763375072596,
    "type": "completion",
    "prompt": "",
    "response": "\n    Only users with \"approver\" role in their JWT can access this endpoint.",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 75
  },
  {
    "id": "3edea695-53ad-438b-aa16-22a77c0d19a2",
    "timestamp": 1763375072601,
    "type": "completion",
    "prompt": "",
    "response": "\n    Protected endpoint that requires \"approver\" role.",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 54
  },
  {
    "id": "51798290-445d-43b5-9403-b135d9b360d2",
    "timestamp": 1763375072602,
    "type": "completion",
    "prompt": "",
    "response": "\nasync def admin_only_endpoint(current_user: Dict[str, Any] = Depends(require_approver_role)):",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 94
  },
  {
    "id": "e2097dc8-ba1d-421b-8779-2bbe586db123",
    "timestamp": 1763375072610,
    "type": "completion",
    "prompt": "",
    "response": "\n@app.get(\"/api/admin-only\")",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 28
  },
  {
    "id": "1962e063-04aa-4cae-9009-e89780dca346",
    "timestamp": 1763375072611,
    "type": "completion",
    "prompt": "",
    "response": "\n        \"raw_claims\": current_user  # Include all claims for debugging",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 71
  },
  {
    "id": "28de015e-9ec0-43a3-b1dc-4901bc2a7b7e",
    "timestamp": 1763375072612,
    "type": "completion",
    "prompt": "",
    "response": "\n        \"profile\": profile,",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 28
  },
  {
    "id": "b726dbfd-92c1-4d4a-bdfc-065f9efb3107",
    "timestamp": 1763375072618,
    "type": "completion",
    "prompt": "",
    "response": "\n        \"message\": \"Profile retrieved successfully\",",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 53
  },
  {
    "id": "cd8a03e8-7a71-4514-87ac-fb2bb2ce5ce4",
    "timestamp": 1763375072620,
    "type": "completion",
    "prompt": "",
    "response": "\n    profile = {k: v for k, v in profile.items() if v is not None}",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 66
  },
  {
    "id": "4b920cda-72dc-4b53-9abb-fa53450e2f6b",
    "timestamp": 1763375072627,
    "type": "completion",
    "prompt": "",
    "response": "\n    # Remove None values for cleaner response",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 46
  },
  {
    "id": "4710f6f8-3fa8-46fb-958e-01b306d11469",
    "timestamp": 1763375072628,
    "type": "completion",
    "prompt": "",
    "response": "\n        \"scope\": current_user.get(\"scp\"),",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 42
  },
  {
    "id": "8f89ce5f-506d-4d8e-8d41-493b20209b55",
    "timestamp": 1763375072633,
    "type": "completion",
    "prompt": "",
    "response": "\n        \"app_id\": current_user.get(\"appid\"),",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 45
  },
  {
    "id": "07185e86-1d8e-4821-882a-b49f0ee98f19",
    "timestamp": 1763375072634,
    "type": "completion",
    "prompt": "",
    "response": "\n        \"tenant_id\": current_user.get(\"tid\"),",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 46
  },
  {
    "id": "43d15d7d-cf4a-4907-a07d-b4fd58f504e2",
    "timestamp": 1763375072640,
    "type": "completion",
    "prompt": "",
    "response": "\n        \"roles\": current_user.get(\"roles\", []),",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 48
  },
  {
    "id": "0be10bf3-3068-417b-b325-b914db1cb7bd",
    "timestamp": 1763375072641,
    "type": "completion",
    "prompt": "",
    "response": "\n        \"family_name\": current_user.get(\"family_name\"),",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 56
  },
  {
    "id": "156021ab-6f5a-4cf1-bf3a-a4125b6ca9c6",
    "timestamp": 1763375072646,
    "type": "completion",
    "prompt": "",
    "response": "\n        \"given_name\": current_user.get(\"given_name\"),",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 54
  },
  {
    "id": "6bf017d9-f584-4d73-ab0b-827bd41cf081",
    "timestamp": 1763375072646,
    "type": "completion",
    "prompt": "",
    "response": "\n        \"name\": current_user.get(\"name\"),",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 42
  },
  {
    "id": "55936889-e376-4c77-a573-f59b830d705d",
    "timestamp": 1763375072653,
    "type": "completion",
    "prompt": "",
    "response": "\n        \"email\": current_user.get(\"email\") or current_user.get(\"preferred_username\"),",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 86
  },
  {
    "id": "1b2050a7-659f-486f-b5ee-917fc09c05e7",
    "timestamp": 1763375072655,
    "type": "completion",
    "prompt": "",
    "response": "\n        \"user_id\": current_user.get(\"sub\"),",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 44
  },
  {
    "id": "27aebc3c-f905-4c81-8059-14dfda81cbdf",
    "timestamp": 1763375072660,
    "type": "completion",
    "prompt": "",
    "response": "\n    # Extract useful profile information from claims",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 53
  },
  {
    "id": "ebca42e7-fb6f-45e7-a377-3e910fa2cb7e",
    "timestamp": 1763375072661,
    "type": "completion",
    "prompt": "",
    "response": "\n        User profile information extracted from JWT claims",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 59
  },
  {
    "id": "8870930b-c7c0-4c81-b154-7a95d6065516",
    "timestamp": 1763375072666,
    "type": "completion",
    "prompt": "",
    "response": "\n        current_user: Authenticated user claims from JWT",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 57
  },
  {
    "id": "62e27738-5035-44ba-b9be-fe2455b57dab",
    "timestamp": 1763375072668,
    "type": "completion",
    "prompt": "",
    "response": "\n    Requires valid Bearer JWT token in Authorization header.",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 61
  },
  {
    "id": "be06b6a5-fd09-46e8-9fb8-155a7fda9d02",
    "timestamp": 1763375072672,
    "type": "completion",
    "prompt": "",
    "response": "\n    Protected endpoint that returns user profile information from JWT claims.",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 78
  },
  {
    "id": "4c5cb6c2-113e-4d91-b39b-5027233ba798",
    "timestamp": 1763375072674,
    "type": "completion",
    "prompt": "",
    "response": "\nasync def get_profile(current_user: Dict[str, Any] = Depends(get_current_user)):",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 81
  },
  {
    "id": "10306e85-32b2-44b6-b3e6-dfbcb904b4f1",
    "timestamp": 1763375072678,
    "type": "completion",
    "prompt": "",
    "response": "\n@app.get(\"/api/profile\")",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 25
  },
  {
    "id": "a88cf7ce-55fb-4115-9db9-4cdf01b248ce",
    "timestamp": 1763375072680,
    "type": "completion",
    "prompt": "",
    "response": "\n    return {\"ok\": True}",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 24
  },
  {
    "id": "a4c4c2a1-08d4-4836-b95d-1233c8afb6d8",
    "timestamp": 1763375072685,
    "type": "completion",
    "prompt": "",
    "response": "\n        Simple health status",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 29
  },
  {
    "id": "d162e6eb-54f9-4795-8d2e-eb4fbe307b32",
    "timestamp": 1763375072687,
    "type": "completion",
    "prompt": "",
    "response": "\n    Health check endpoint - no authentication required.",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 56
  },
  {
    "id": "87631114-e53b-421f-9b27-02ad52539a65",
    "timestamp": 1763375072693,
    "type": "completion",
    "prompt": "",
    "response": "\nasync def health_check():",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 26
  },
  {
    "id": "118d6740-5e95-4ca5-b967-4ff39231e2a5",
    "timestamp": 1763375072694,
    "type": "completion",
    "prompt": "",
    "response": "\n    return current_user",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 24
  },
  {
    "id": "52655c76-5e6f-4786-b8aa-0c0db27fe61c",
    "timestamp": 1763375072698,
    "type": "completion",
    "prompt": "",
    "response": "\n            detail=\"Access denied: 'approver' role required\"",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 61
  },
  {
    "id": "f484a214-8df8-45f0-9a90-710376044817",
    "timestamp": 1763375072699,
    "type": "completion",
    "prompt": "",
    "response": "\n            status_code=status.HTTP_403_FORBIDDEN,",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 51
  },
  {
    "id": "9fd44fce-8d6a-4e84-9fc6-e58a1a63f9b8",
    "timestamp": 1763375072705,
    "type": "completion",
    "prompt": "",
    "response": "\n        raise HTTPException(",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 29
  },
  {
    "id": "50988bd1-c2dd-4a84-9773-616115fbec3b",
    "timestamp": 1763375072706,
    "type": "completion",
    "prompt": "",
    "response": "\n    if not has_required_role(current_user, \"approver\"):",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 56
  },
  {
    "id": "d54117da-5589-4035-a5b0-661f68722c0e",
    "timestamp": 1763375072711,
    "type": "completion",
    "prompt": "",
    "response": "\n        HTTPException: 403 if user doesn't have required role",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 62
  },
  {
    "id": "dc387b3c-7dda-4737-a21a-a39ea0d7c556",
    "timestamp": 1763375072712,
    "type": "completion",
    "prompt": "",
    "response": "\n        User claims if authorized",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 34
  },
  {
    "id": "2bfe9bc7-c361-4d48-a559-e8fb6931b982",
    "timestamp": 1763375072718,
    "type": "completion",
    "prompt": "",
    "response": "\n        current_user: Current authenticated user claims",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 56
  },
  {
    "id": "bf0b342d-b879-4db3-a289-7842a51a23db",
    "timestamp": 1763375072720,
    "type": "completion",
    "prompt": "",
    "response": "\n    Dependency that requires the user to have \"approver\" role.",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 63
  },
  {
    "id": "a1d3e647-cdb4-424f-9319-b3b86624a5ae",
    "timestamp": 1763375072726,
    "type": "completion",
    "prompt": "",
    "response": "\nasync def require_approver_role(current_user: Dict[str, Any] = Depends(get_current_user)) -> Dict[str, Any]:",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 109
  },
  {
    "id": "3983aa37-c3ad-4d40-b5a1-0d97cffd2c16",
    "timestamp": 1763375072728,
    "type": "completion",
    "prompt": "",
    "response": "\n            headers={\"WWW-Authenticate\": \"Bearer\"},",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 52
  },
  {
    "id": "2edfbdaf-0780-4886-88e2-8f689563f649",
    "timestamp": 1763375072734,
    "type": "completion",
    "prompt": "",
    "response": "\n            detail=f\"Token validation failed: {str(e)}\",",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 57
  },
  {
    "id": "bff9597c-7d06-4687-acf0-b72916650131",
    "timestamp": 1763375072735,
    "type": "completion",
    "prompt": "",
    "response": "\n            status_code=status.HTTP_401_UNAUTHORIZED,",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 54
  },
  {
    "id": "29fcadff-252c-4092-aaf9-03e75cbcdd04",
    "timestamp": 1763375072740,
    "type": "completion",
    "prompt": "",
    "response": "\n        raise HTTPException(",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 29
  },
  {
    "id": "dc8f23a9-edc8-4934-a8c3-e25cfea21192",
    "timestamp": 1763375072741,
    "type": "completion",
    "prompt": "",
    "response": "\n        logger.error(f\"Token verification failed: {str(e)}\")",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 61
  },
  {
    "id": "85fc5959-4280-40b0-9e85-5358f31c6552",
    "timestamp": 1763375072745,
    "type": "completion",
    "prompt": "",
    "response": "\n    except Exception as e:",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 27
  },
  {
    "id": "c79502b2-5f58-4ad7-9849-9939f4f06d23",
    "timestamp": 1763375072747,
    "type": "completion",
    "prompt": "",
    "response": "\n        return claims",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 22
  },
  {
    "id": "d49c996a-0af5-4749-8843-c3757cf415f6",
    "timestamp": 1763375072751,
    "type": "completion",
    "prompt": "",
    "response": "\n        logger.info(f\"Successfully authenticated user: {claims.get('preferred_username', 'unknown')}\")",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 103
  },
  {
    "id": "785390c0-68f7-47d7-83f8-a07feb4a290e",
    "timestamp": 1763375072753,
    "type": "completion",
    "prompt": "",
    "response": "\n        claims = await verify_jwt(token)",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 41
  },
  {
    "id": "2a436781-1e9c-4a2d-ad11-6f3c4c4a7663",
    "timestamp": 1763375072759,
    "type": "completion",
    "prompt": "",
    "response": "\n        # Verify the JWT token",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 31
  },
  {
    "id": "9a0c8ee7-4771-45bd-b531-596a9c153a77",
    "timestamp": 1763375072761,
    "type": "completion",
    "prompt": "",
    "response": "\n    token = credentials.credentials",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 36
  },
  {
    "id": "9c14e0f9-57ca-49e7-9aca-52fd9d22085b",
    "timestamp": 1763375072767,
    "type": "completion",
    "prompt": "",
    "response": "\n            headers={\"WWW-Authenticate\": \"Bearer\"},",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 52
  },
  {
    "id": "104da169-f01c-428b-96f7-a572685bdbd1",
    "timestamp": 1763375072769,
    "type": "completion",
    "prompt": "",
    "response": "\n            detail=\"Authorization header missing or invalid\",",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 62
  },
  {
    "id": "db15897e-b962-45cd-808b-165027398a88",
    "timestamp": 1763375072776,
    "type": "completion",
    "prompt": "",
    "response": "\n            status_code=status.HTTP_401_UNAUTHORIZED,",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 54
  },
  {
    "id": "9e1f73e9-381b-4ed2-9354-ecece96d344a",
    "timestamp": 1763375072777,
    "type": "completion",
    "prompt": "",
    "response": "\n        raise HTTPException(",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 29
  },
  {
    "id": "3b60604e-06dc-4a1d-a3af-7756d2431c2f",
    "timestamp": 1763375072790,
    "type": "completion",
    "prompt": "",
    "response": "\n    if not credentials or not credentials.credentials:",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 55
  },
  {
    "id": "a4a447ea-a72a-4fe9-85f3-3d96f5070f47",
    "timestamp": 1763375072792,
    "type": "completion",
    "prompt": "",
    "response": "\n        HTTPException: 401 if token is missing or invalid",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 58
  },
  {
    "id": "17ac522d-f67e-4e5d-8eed-0058b527bee1",
    "timestamp": 1763375072802,
    "type": "completion",
    "prompt": "",
    "response": "\n        Decoded JWT claims",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 27
  },
  {
    "id": "6f003a74-2047-4eee-9dcb-9f66cb7a85d3",
    "timestamp": 1763375072804,
    "type": "completion",
    "prompt": "",
    "response": "\n        credentials: HTTP authorization credentials containing Bearer token",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 76
  },
  {
    "id": "4fefe515-50d0-468a-8e16-c0b129decaac",
    "timestamp": 1763375072810,
    "type": "completion",
    "prompt": "",
    "response": "\n    Dependency to extract and verify JWT token from Authorization header.",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 74
  },
  {
    "id": "406ee509-3739-4846-bd72-48b80a6db527",
    "timestamp": 1763375072812,
    "type": "completion",
    "prompt": "",
    "response": "\nasync def get_current_user(credentials: HTTPAuthorizationCredentials = Depends(security)) -> Dict[str, Any]:",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 109
  },
  {
    "id": "79a37100-0a4b-408e-b48b-0df108b03658",
    "timestamp": 1763375072819,
    "type": "completion",
    "prompt": "",
    "response": "\nsecurity = HTTPBearer()",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 24
  },
  {
    "id": "dae7d47c-50dc-489e-b438-89d3c6486688",
    "timestamp": 1763375072821,
    "type": "completion",
    "prompt": "",
    "response": "\n# Security scheme for Bearer token",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 35
  },
  {
    "id": "e59e8d60-77d5-4ee5-a6da-e85c22ab4c80",
    "timestamp": 1763375072826,
    "type": "completion",
    "prompt": "",
    "response": "\n    description=\"A minimal FastAPI application with Microsoft Entra (Azure AD) JWT validation\",",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 96
  },
  {
    "id": "9807dafe-f0b0-434f-b55f-8c99ec571db5",
    "timestamp": 1763375072827,
    "type": "completion",
    "prompt": "",
    "response": "\n    title=\"Microsoft Entra ID JWT Auth API\",",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 45
  },
  {
    "id": "257cd346-7540-4420-a2ca-6a60d5b9dbc6",
    "timestamp": 1763375072829,
    "type": "completion",
    "prompt": "",
    "response": "\n# Create FastAPI app",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 21
  },
  {
    "id": "c966ceb0-c9bb-4ed8-b000-4e4df487d4fb",
    "timestamp": 1763375072833,
    "type": "completion",
    "prompt": "",
    "response": "\nlogger = logging.getLogger(__name__)",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 37
  },
  {
    "id": "7215d910-dff7-49e8-876b-41e500795302",
    "timestamp": 1763375072835,
    "type": "completion",
    "prompt": "",
    "response": "\nlogging.basicConfig(level=logging.INFO)",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 40
  },
  {
    "id": "394e05a2-7b1d-4273-9c58-ca0bf0f39e26",
    "timestamp": 1763375072840,
    "type": "completion",
    "prompt": "",
    "response": "\nfrom auth import verify_jwt, has_required_role",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 47
  },
  {
    "id": "5689a424-cbb6-4fb9-818c-b39edd0493c7",
    "timestamp": 1763375072842,
    "type": "completion",
    "prompt": "",
    "response": "\nfrom typing import Dict, Any",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 29
  },
  {
    "id": "8fcb9392-e314-4f9d-b2d0-cbd21870f017",
    "timestamp": 1763375072848,
    "type": "completion",
    "prompt": "",
    "response": "\nfrom fastapi.security import HTTPBearer, HTTPAuthorizationCredentials",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 70
  },
  {
    "id": "055ea46a-c5e9-4a92-957c-eb407155f76f",
    "timestamp": 1763375072850,
    "type": "completion",
    "prompt": "",
    "response": "from fastapi import FastAPI, Depends, HTTPException, status",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 59
  },
  {
    "id": "43ecccfa-a05e-4391-8648-a5e5a56b5c47",
    "timestamp": 1763375096720,
    "type": "completion",
    "prompt": "",
    "response": "\n- Regular security updates for dependencies",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 44
  },
  {
    "id": "a91f450a-7662-41ee-89d9-8a661fc74e95",
    "timestamp": 1763375096722,
    "type": "completion",
    "prompt": "",
    "response": "\n- Monitor and log security events",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 34
  },
  {
    "id": "05c13d62-2138-4bd7-8e8a-8f4e86434863",
    "timestamp": 1763375096803,
    "type": "completion",
    "prompt": "",
    "response": "\n- Consider rate limiting and additional security middleware",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 60
  },
  {
    "id": "2a613a7a-ec4b-4eca-afff-aa3c6ac1a187",
    "timestamp": 1763375096805,
    "type": "completion",
    "prompt": "",
    "response": "\n- Enable HTTPS in production",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 29
  },
  {
    "id": "c1a8c7c1-3ca4-486f-acf8-6675adbe6bc8",
    "timestamp": 1763375096807,
    "type": "completion",
    "prompt": "",
    "response": "\n- Use environment variables or secure configuration management",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 63
  },
  {
    "id": "6a79dd6e-95c1-4212-b9d6-9c0891c25351",
    "timestamp": 1763375096808,
    "type": "completion",
    "prompt": "",
    "response": "\n## Production Considerations",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 29
  },
  {
    "id": "7e7931f9-a376-480c-8ee4-b70ae60caada",
    "timestamp": 1763375096811,
    "type": "completion",
    "prompt": "",
    "response": "\nuvicorn main:app --reload --log-level debug",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 44
  },
  {
    "id": "71243e91-82cb-404c-83bf-d8d00e0d4180",
    "timestamp": 1763375096811,
    "type": "completion",
    "prompt": "",
    "response": "\nTo run in development mode with auto-reload:",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 45
  },
  {
    "id": "affe85d5-8714-44af-a275-d5f2b723ffc1",
    "timestamp": 1763375096813,
    "type": "completion",
    "prompt": "",
    "response": "\nThe application logs authentication events. Check console output for detailed error messages.",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 94
  },
  {
    "id": "46125fc0-4dc6-44c2-ac36-b0e012091842",
    "timestamp": 1763375096814,
    "type": "completion",
    "prompt": "",
    "response": "\n   - Check App roles configuration in Azure Portal",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 51
  },
  {
    "id": "2f053d4e-8731-4224-acd1-c98fe2d108bc",
    "timestamp": 1763375096816,
    "type": "completion",
    "prompt": "",
    "response": "\n   - User needs \"approver\" role assigned in Azure AD",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 53
  },
  {
    "id": "44721013-786f-46d2-b30f-aea648514e1a",
    "timestamp": 1763375096817,
    "type": "completion",
    "prompt": "",
    "response": "\n4. **\"Access denied: 'approver' role required\"**",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 49
  },
  {
    "id": "be9610bc-9035-444f-b184-216d38781199",
    "timestamp": 1763375096819,
    "type": "completion",
    "prompt": "",
    "response": "\n   - Verify TENANT_ID and API_AUDIENCE match your Azure AD configuration",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 73
  },
  {
    "id": "39ac27ee-d29a-4675-8765-0c65fa5997a7",
    "timestamp": 1763375096820,
    "type": "completion",
    "prompt": "",
    "response": "\n   - Check that your JWT token is valid and not expired",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 56
  },
  {
    "id": "624d84a1-2987-4649-885e-22f841148a4e",
    "timestamp": 1763375096822,
    "type": "completion",
    "prompt": "",
    "response": "\n3. **\"Token validation failed\"**",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 33
  },
  {
    "id": "f12034ff-e92c-450c-a186-a3a0a6cfe5df",
    "timestamp": 1763375096823,
    "type": "completion",
    "prompt": "",
    "response": "\n   - Set either API_AUDIENCE or CLIENT_ID environment variable",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 63
  },
  {
    "id": "73a24844-1370-401f-bf0a-8ea1ff2dc540",
    "timestamp": 1763375096824,
    "type": "completion",
    "prompt": "",
    "response": "\n2. **\"API_AUDIENCE environment variable is required\"**",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 55
  },
  {
    "id": "7b077705-1d5f-4187-b5b9-f0732e7cb8b2",
    "timestamp": 1763375096826,
    "type": "completion",
    "prompt": "",
    "response": "\n   - Set the TENANT_ID environment variable",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 44
  },
  {
    "id": "d9838599-ec38-41ea-9407-a90273f90a81",
    "timestamp": 1763375096828,
    "type": "completion",
    "prompt": "",
    "response": "\n1. **\"TENANT_ID environment variable is required\"**",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 52
  },
  {
    "id": "9179b2a6-748f-410b-b467-f51ebafee979",
    "timestamp": 1763375096829,
    "type": "completion",
    "prompt": "",
    "response": "\n- **Comprehensive error handling**",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 35
  },
  {
    "id": "86a3058b-796c-4f4a-8836-875c28caea4a",
    "timestamp": 1763375096831,
    "type": "completion",
    "prompt": "",
    "response": "\n- **Role-based access control**",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 32
  },
  {
    "id": "dec5fc26-a839-4c62-b091-456d74edfdeb",
    "timestamp": 1763375096831,
    "type": "completion",
    "prompt": "",
    "response": "\n- **JWKS caching** (1 hour TTL) for performance",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 48
  },
  {
    "id": "5f1398e6-433c-46c5-ba9b-eb8dce32c8c1",
    "timestamp": 1763375096833,
    "type": "completion",
    "prompt": "",
    "response": "\n- **Audience and issuer validation**",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 37
  },
  {
    "id": "2ba9cd9c-8dee-4d5e-9c20-47637de25e26",
    "timestamp": 1763375096834,
    "type": "completion",
    "prompt": "",
    "response": "\n- **Token expiration validation**",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 34
  },
  {
    "id": "20d21956-ff43-4f59-b2af-37db988689af",
    "timestamp": 1763375096838,
    "type": "completion",
    "prompt": "",
    "response": "\n- **Token signature verification** using RSA256 and JWKS",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 57
  },
  {
    "id": "b5af4bd0-5f8d-465d-94aa-fe01e87972b3",
    "timestamp": 1763375096842,
    "type": "completion",
    "prompt": "",
    "response": "\n## Security Features",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 21
  },
  {
    "id": "f54d30b1-544c-45ac-a831-2c691182ec27",
    "timestamp": 1763375096846,
    "type": "completion",
    "prompt": "",
    "response": "\n- `name`: User's display name",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 30
  },
  {
    "id": "0e2fa9f2-e1f6-4dae-8c37-09d9193acbe0",
    "timestamp": 1763375096847,
    "type": "completion",
    "prompt": "",
    "response": "\n- `preferred_username`: User's email/username",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 46
  },
  {
    "id": "b6f08b86-48c8-49c4-8b93-7c002f28ef9c",
    "timestamp": 1763375096851,
    "type": "completion",
    "prompt": "",
    "response": "\n- `roles`: Array of assigned roles (for role-based access)",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 59
  },
  {
    "id": "2b142a7d-4d26-400b-a363-73e5c63fae7f",
    "timestamp": 1763375096858,
    "type": "completion",
    "prompt": "",
    "response": "\n- `exp`: Expiration time",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 25
  },
  {
    "id": "ba4fe72d-7a7d-495a-a506-f4d9790c82b2",
    "timestamp": 1763375096864,
    "type": "completion",
    "prompt": "",
    "response": "\n- `iss`: Issuer (Azure AD)",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 27
  },
  {
    "id": "0353da49-8a63-4318-8069-587b4e277df9",
    "timestamp": 1763375096865,
    "type": "completion",
    "prompt": "",
    "response": "\n- `aud`: Audience (should match your API_AUDIENCE)",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 51
  },
  {
    "id": "b3dee619-20c4-4245-8823-8da3a6bb0ff2",
    "timestamp": 1763375096868,
    "type": "completion",
    "prompt": "",
    "response": "\n- `sub`: Subject (user ID)",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 27
  },
  {
    "id": "82016059-994d-4d08-932f-685e3a48607e",
    "timestamp": 1763375096869,
    "type": "completion",
    "prompt": "",
    "response": "\nThe application expects standard Azure AD v2.0 token claims:",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 61
  },
  {
    "id": "19bc4c91-b08c-44ed-a110-2c6e4f239a7b",
    "timestamp": 1763375096873,
    "type": "completion",
    "prompt": "",
    "response": "\n### JWT Token Claims",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 21
  },
  {
    "id": "337ad009-a3ae-427b-a55b-5bcc8d7bc803",
    "timestamp": 1763375096874,
    "type": "completion",
    "prompt": "",
    "response": "\n4. **Token configuration**: Ensure proper claims are included in tokens",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 72
  },
  {
    "id": "bdc06e8e-0aff-44a4-9e20-88e6600e2237",
    "timestamp": 1763375096877,
    "type": "completion",
    "prompt": "",
    "response": "\n3. **App roles** (optional): Define custom roles like \"approver\" for role-based access",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 87
  },
  {
    "id": "b4dcc5a0-20ac-41a0-9cec-847b4a1b31e5",
    "timestamp": 1763375096878,
    "type": "completion",
    "prompt": "",
    "response": "\n2. **API permissions**: Grant necessary Microsoft Graph permissions if needed",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 78
  },
  {
    "id": "f5bfc252-b1f5-4cfa-8fa1-ad4077793179",
    "timestamp": 1763375096881,
    "type": "completion",
    "prompt": "",
    "response": "\n1. **Authentication**: Configure redirect URIs if using interactive flows",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 74
  },
  {
    "id": "228e7f63-4592-4d0c-bf81-647865470580",
    "timestamp": 1763375096882,
    "type": "completion",
    "prompt": "",
    "response": "\nYour Azure AD application should be configured with:",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 53
  },
  {
    "id": "1d65d72a-d5f3-4dfa-b582-6d46c98cb554",
    "timestamp": 1763375096884,
    "type": "completion",
    "prompt": "",
    "response": "\n### Azure AD App Registration",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 30
  },
  {
    "id": "03abc834-9326-4adb-9bd5-b851c8f911fa",
    "timestamp": 1763375096885,
    "type": "completion",
    "prompt": "",
    "response": "\n## Configuration Details",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 25
  },
  {
    "id": "51611181-dd12-4676-85fc-477f25891be7",
    "timestamp": 1763375096887,
    "type": "completion",
    "prompt": "",
    "response": "\n- `README.md` - This documentation",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 35
  },
  {
    "id": "90502fac-8add-44d0-9215-8fce0563246b",
    "timestamp": 1763375096888,
    "type": "completion",
    "prompt": "",
    "response": "\n- `main.py` - FastAPI application with endpoints and middleware",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 64
  },
  {
    "id": "f14ac4f0-8e3d-4fdf-9f23-874bd561cf6c",
    "timestamp": 1763375096890,
    "type": "completion",
    "prompt": "",
    "response": "\n- `auth.py` - JWT verification logic and JWKS handling",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 55
  },
  {
    "id": "b30aebb3-f21a-457b-a1f5-3ddcdde26dcd",
    "timestamp": 1763375096891,
    "type": "completion",
    "prompt": "",
    "response": "\n     http://localhost:8000/api/admin-only",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 42
  },
  {
    "id": "15f59aa2-fb03-47cc-b25b-d9b2eab74ace",
    "timestamp": 1763375096893,
    "type": "completion",
    "prompt": "",
    "response": "\ncurl -H \"Authorization: Bearer YOUR_JWT_TOKEN\" \\",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 49
  },
  {
    "id": "1d5f7471-3954-4be1-8327-1c2d6da67d0c",
    "timestamp": 1763375096894,
    "type": "completion",
    "prompt": "",
    "response": "\n# Admin endpoint (requires JWT with \"approver\" role)",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 53
  },
  {
    "id": "e5a25190-5cb2-4405-90a0-651a1b2d1286",
    "timestamp": 1763375096896,
    "type": "completion",
    "prompt": "",
    "response": "\n     http://localhost:8000/api/profile",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 39
  },
  {
    "id": "0424c676-3c61-400c-8e72-3496e2f742e1",
    "timestamp": 1763375096897,
    "type": "completion",
    "prompt": "",
    "response": "\ncurl -H \"Authorization: Bearer YOUR_JWT_TOKEN\" \\",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 49
  },
  {
    "id": "7951cd12-d2dc-4a32-b370-636441f46014",
    "timestamp": 1763375096899,
    "type": "completion",
    "prompt": "",
    "response": "\n# Profile endpoint (requires JWT)",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 34
  },
  {
    "id": "86353903-294f-4f25-b90f-8adac559ef97",
    "timestamp": 1763375096900,
    "type": "completion",
    "prompt": "",
    "response": "\ncurl http://localhost:8000/health",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 34
  },
  {
    "id": "9d3a9911-f8df-43db-903f-cb188c4ccf06",
    "timestamp": 1763375096902,
    "type": "completion",
    "prompt": "",
    "response": "\n# Health check (no auth required)",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 34
  },
  {
    "id": "c7189a2d-d85d-4bf9-a917-95643bad7e82",
    "timestamp": 1763375096903,
    "type": "completion",
    "prompt": "",
    "response": "\n### Example using curl",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 23
  },
  {
    "id": "210ee5d4-c73d-4fc2-8311-441a9d914fab",
    "timestamp": 1763375096905,
    "type": "completion",
    "prompt": "",
    "response": "\n2. **For testing**: You can use tools like Postman with Azure AD OAuth2 flow",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 77
  },
  {
    "id": "6f864b2d-aa00-4c88-87af-39ffbba8c82e",
    "timestamp": 1763375096906,
    "type": "completion",
    "prompt": "",
    "response": "\n1. **From Azure AD**: Use Azure CLI, PowerShell, or your application's login flow",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 82
  },
  {
    "id": "c632c22b-eeae-4252-9d34-e09afc01b36d",
    "timestamp": 1763375096908,
    "type": "completion",
    "prompt": "",
    "response": "\n### Getting a JWT Token",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 24
  },
  {
    "id": "c5133cc5-fb29-4455-8c19-c0b68d63c008",
    "timestamp": 1763375096909,
    "type": "completion",
    "prompt": "",
    "response": "\n## Testing with JWT Tokens",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 27
  },
  {
    "id": "0706c8fc-eef3-4b27-a863-6cde9bded8dd",
    "timestamp": 1763375096912,
    "type": "completion",
    "prompt": "",
    "response": "\nRequires \"approver\" role in JWT token.",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 39
  },
  {
    "id": "9c031dd2-2c69-492a-9f84-dd79cceb7d5f",
    "timestamp": 1763375096913,
    "type": "completion",
    "prompt": "",
    "response": "\nAuthorization: Bearer <your-jwt-token>",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 39
  },
  {
    "id": "2027ffe0-1840-428e-a7b5-a6465bc25266",
    "timestamp": 1763375096915,
    "type": "completion",
    "prompt": "",
    "response": "\n### 3. Admin Only (Role-Protected)",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 35
  },
  {
    "id": "c36e128e-e289-4513-b730-8656047c1890",
    "timestamp": 1763375096916,
    "type": "completion",
    "prompt": "",
    "response": "\nReturns user profile information from JWT claims.",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 50
  },
  {
    "id": "367f3148-5465-433b-81b5-5e891e80348b",
    "timestamp": 1763375096919,
    "type": "completion",
    "prompt": "",
    "response": "\nAuthorization: Bearer <your-jwt-token>",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 39
  },
  {
    "id": "db9a3830-e55c-4926-b086-2d931378a1cf",
    "timestamp": 1763375096920,
    "type": "completion",
    "prompt": "",
    "response": "\n### 2. User Profile (Protected)",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 32
  },
  {
    "id": "18e94d18-9b68-42ec-b909-361ace149e2f",
    "timestamp": 1763375096922,
    "type": "completion",
    "prompt": "",
    "response": "\nReturns: `{\"ok\": true}`",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 24
  },
  {
    "id": "d9f0ce02-bf9f-4524-a897-05cafbe8be33",
    "timestamp": 1763375096923,
    "type": "completion",
    "prompt": "",
    "response": "\n### 1. Health Check (Public)",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 29
  },
  {
    "id": "4e5efa8e-735c-43d5-9fd4-d8c701235494",
    "timestamp": 1763375096925,
    "type": "completion",
    "prompt": "",
    "response": "\n- **ReDoc documentation**: `http://localhost:8000/redoc`",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 57
  },
  {
    "id": "440d264e-a363-4fbf-ba42-fdc06d92e4b8",
    "timestamp": 1763375096926,
    "type": "completion",
    "prompt": "",
    "response": "\n- **Interactive API docs**: `http://localhost:8000/docs`",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 57
  },
  {
    "id": "4b6d82c0-c48d-4ee2-a17e-0340f391e3eb",
    "timestamp": 1763375096929,
    "type": "completion",
    "prompt": "",
    "response": "\nOnce running, visit:",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 21
  },
  {
    "id": "0a1dda01-2ade-481c-b8f2-1b15782f0caa",
    "timestamp": 1763375096930,
    "type": "completion",
    "prompt": "",
    "response": "\n## API Documentation",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 21
  },
  {
    "id": "9631c0cd-1589-4f10-8b0b-23eeabec94ce",
    "timestamp": 1763375096932,
    "type": "completion",
    "prompt": "",
    "response": "\nThe API will be available at `http://localhost:8000`",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 53
  },
  {
    "id": "f489f034-409f-45af-a9c3-ed919554c0f4",
    "timestamp": 1763375096933,
    "type": "completion",
    "prompt": "",
    "response": "\n   uvicorn main:app --reload",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 29
  },
  {
    "id": "04d45b15-cd2d-4e90-88b0-4acb3bbeb390",
    "timestamp": 1763375096935,
    "type": "completion",
    "prompt": "",
    "response": "\n4. **Run the application**:",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 28
  },
  {
    "id": "6a451ba6-ed62-4f68-a48a-916780d6baf4",
    "timestamp": 1763375096936,
    "type": "completion",
    "prompt": "",
    "response": "\n3. **Set environment variables** (see above)",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 45
  },
  {
    "id": "b4cd1564-08a0-4d56-a1b9-0374abf4347f",
    "timestamp": 1763375096939,
    "type": "completion",
    "prompt": "",
    "response": "\n   pip install fastapi uvicorn python-jose[cryptography] httpx cachetools",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 74
  },
  {
    "id": "40f3491a-b0d0-4e3d-bcf6-03d0da2cff91",
    "timestamp": 1763375096940,
    "type": "completion",
    "prompt": "",
    "response": "\n2. **Install dependencies**:",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 29
  },
  {
    "id": "9cc1d44f-b6d7-4f5d-afcd-319d8ac9169e",
    "timestamp": 1763375096942,
    "type": "completion",
    "prompt": "",
    "response": "\n1. **Clone or create the project directory**",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 45
  },
  {
    "id": "33c9c9a8-8449-4e73-9df9-949192a907c6",
    "timestamp": 1763375096943,
    "type": "completion",
    "prompt": "",
    "response": "\npip install python-dotenv",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 26
  },
  {
    "id": "72b7657a-56e9-48e7-a139-1e82d9ffef2c",
    "timestamp": 1763375096946,
    "type": "completion",
    "prompt": "",
    "response": "\nThen install python-dotenv and load it in your application:",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 60
  },
  {
    "id": "7e61f448-446d-485e-a72b-a48030dad25a",
    "timestamp": 1763375096946,
    "type": "completion",
    "prompt": "",
    "response": "\nAPI_AUDIENCE=your-client-id-here",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 33
  },
  {
    "id": "0e52bc88-b491-44d2-83d6-f20ba4d9800f",
    "timestamp": 1763375096949,
    "type": "completion",
    "prompt": "",
    "response": "\nTENANT_ID=your-tenant-id-here",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 30
  },
  {
    "id": "52e2bc4f-79dd-4d15-83f9-55f4f446a9fd",
    "timestamp": 1763375096950,
    "type": "completion",
    "prompt": "",
    "response": "\nCreate a `.env` file in the project root:",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 42
  },
  {
    "id": "141e3975-c3f6-406a-8402-af60621954c6",
    "timestamp": 1763375096953,
    "type": "completion",
    "prompt": "",
    "response": "\n#### Option 2: Create .env file (recommended)",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 46
  },
  {
    "id": "d7a3e774-4fb6-41d1-acb5-347c2b015487",
    "timestamp": 1763375096955,
    "type": "completion",
    "prompt": "",
    "response": "\nexport API_AUDIENCE=\"your-client-id-here\"",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 42
  },
  {
    "id": "1aeacb70-e5a2-4ecb-b0ec-ca70bdd7a89a",
    "timestamp": 1763375096964,
    "type": "completion",
    "prompt": "",
    "response": "\nexport TENANT_ID=\"your-tenant-id-here\"",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 39
  },
  {
    "id": "428e4923-343e-4c1a-b6fe-74ceb9c94d07",
    "timestamp": 1763375096966,
    "type": "completion",
    "prompt": "",
    "response": "\n#### Option 1: Export in terminal (temporary)",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 46
  },
  {
    "id": "5fbb1c6c-36db-42a7-b0a3-b3877396122e",
    "timestamp": 1763375096972,
    "type": "completion",
    "prompt": "",
    "response": "\n### Setting Environment Variables",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 34
  },
  {
    "id": "c4f560bd-d7e2-4425-9767-1f0e3240d461",
    "timestamp": 1763375096973,
    "type": "completion",
    "prompt": "",
    "response": "\n   - Example: `87654321-4321-4321-4321-210987654321`",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 53
  },
  {
    "id": "cfda0058-b9b8-4adc-8c27-8d68b9950d93",
    "timestamp": 1763375096977,
    "type": "completion",
    "prompt": "",
    "response": "\n   - Find this in Azure Portal  App registrations  Your App  Overview  Application (client) ID",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 99
  },
  {
    "id": "b11911a5-33b2-4261-9fad-41eea71d1704",
    "timestamp": 1763375096979,
    "type": "completion",
    "prompt": "",
    "response": "\n2. **API_AUDIENCE** (or **CLIENT_ID**): Your application's client ID or audience",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 81
  },
  {
    "id": "6b8017c1-ff3c-4e67-8baf-db7d444b3eca",
    "timestamp": 1763375096983,
    "type": "completion",
    "prompt": "",
    "response": "\n   - Example: `12345678-1234-1234-1234-123456789012`",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 53
  },
  {
    "id": "824eb37f-8dd3-4aa8-ba32-93bf7bd896d9",
    "timestamp": 1763375096985,
    "type": "completion",
    "prompt": "",
    "response": "\n   - Find this in Azure Portal  Azure Active Directory  Overview  Tenant ID",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 79
  },
  {
    "id": "5be5a046-4b38-4b21-8142-bf3bb01a7d74",
    "timestamp": 1763375096990,
    "type": "completion",
    "prompt": "",
    "response": "\n1. **TENANT_ID**: Your Azure AD tenant ID",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 42
  },
  {
    "id": "b6849977-61c8-4d79-aa7f-da86949a84b4",
    "timestamp": 1763375096991,
    "type": "completion",
    "prompt": "",
    "response": "\n### Required Variables",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 23
  },
  {
    "id": "a2af7926-94f7-4665-9c4d-2ee1a7260b83",
    "timestamp": 1763375096995,
    "type": "completion",
    "prompt": "",
    "response": "\nYou need to set the following environment variables:",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 53
  },
  {
    "id": "300fc2b5-2663-49ef-921b-2dd3bef90b72",
    "timestamp": 1763375096997,
    "type": "completion",
    "prompt": "",
    "response": "\n## Environment Variables",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 25
  },
  {
    "id": "14d457fb-0f46-4f34-b5d6-3d91d2015ebd",
    "timestamp": 1763375097002,
    "type": "completion",
    "prompt": "",
    "response": "\n- Registered application in Azure AD",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 37
  },
  {
    "id": "683b16e8-eebe-46be-b06a-8c0aa3512d13",
    "timestamp": 1763375097003,
    "type": "completion",
    "prompt": "",
    "response": "\n- Microsoft Entra ID (Azure AD) tenant",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 39
  },
  {
    "id": "dd3b92b2-e28c-4d89-be0a-85321fe46cb1",
    "timestamp": 1763375097009,
    "type": "completion",
    "prompt": "",
    "response": "\n  - `/api/admin-only` - Admin endpoint (requires \"approver\" role)",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 66
  },
  {
    "id": "097d79be-48fe-4b73-846e-d105e261bbf3",
    "timestamp": 1763375097010,
    "type": "completion",
    "prompt": "",
    "response": "\n  - `/api/profile` - Protected profile endpoint (requires valid JWT)",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 69
  },
  {
    "id": "69cf17d8-2f7b-44f2-b7b3-94e1f9493d57",
    "timestamp": 1763375097014,
    "type": "completion",
    "prompt": "",
    "response": "\n  - `/health` - Public health check",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 36
  },
  {
    "id": "df5b45b8-5f1d-41f2-9523-9ed3e9d7429d",
    "timestamp": 1763375097016,
    "type": "completion",
    "prompt": "",
    "response": "\n- Role-based access control",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 28
  },
  {
    "id": "62487dcb-c0e1-440b-b065-e64b4ca322fd",
    "timestamp": 1763375097020,
    "type": "completion",
    "prompt": "",
    "response": "\n- JWKS caching for improved performance",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 40
  },
  {
    "id": "7dde3122-aee0-4779-b72d-b686309047c1",
    "timestamp": 1763375097023,
    "type": "completion",
    "prompt": "",
    "response": "\n- JWT token validation using Microsoft Entra ID JWKS",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 53
  },
  {
    "id": "769d4448-46c8-4422-ac69-8c2e3879d5c7",
    "timestamp": 1763375097028,
    "type": "completion",
    "prompt": "",
    "response": "\nA minimal FastAPI application that validates Microsoft Entra (Azure AD) access tokens using JWKS (JSON Web Key Set).",
    "language": "markdown",
    "filePath": "README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 117
  },
  {
    "id": "1491285a-5db6-47a5-9a1d-320470888b92",
    "timestamp": 1763375102647,
    "type": "completion",
    "prompt": "",
    "response": "\npython-jose[cryptography]==3.3.0",
    "language": "pip-requirements",
    "filePath": "requirements.txt",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 33
  },
  {
    "id": "bceb8f6a-62d3-4562-94d8-5dad7838e344",
    "timestamp": 1763375102658,
    "type": "completion",
    "prompt": "",
    "response": "\nuvicorn[standard]==0.24.0",
    "language": "pip-requirements",
    "filePath": "requirements.txt",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 26
  },
  {
    "id": "15a37002-5ecd-4ee6-8116-3f973658ce60",
    "timestamp": 1763375109261,
    "type": "completion",
    "prompt": "",
    "response": "\n# CLIENT_ID=your-client-id-here",
    "language": "shellscript",
    "filePath": ".env.example",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 32
  },
  {
    "id": "d30d9a20-04eb-409d-8235-b8894a6e11fd",
    "timestamp": 1763375109277,
    "type": "completion",
    "prompt": "",
    "response": "\n# Alternative: You can use CLIENT_ID instead of API_AUDIENCE",
    "language": "shellscript",
    "filePath": ".env.example",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 61
  },
  {
    "id": "e41560f5-0a0b-48a4-9cc1-710ae2bc2b76",
    "timestamp": 1763375109284,
    "type": "completion",
    "prompt": "",
    "response": "\nAPI_AUDIENCE=your-client-id-here",
    "language": "shellscript",
    "filePath": ".env.example",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 33
  },
  {
    "id": "97d4fbfc-67c6-40ee-9a55-3a12e0ec6c6e",
    "timestamp": 1763375109291,
    "type": "completion",
    "prompt": "",
    "response": "\n# Your application's Client ID or API Audience (found in App registrations > Your App > Overview)",
    "language": "shellscript",
    "filePath": ".env.example",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 98
  },
  {
    "id": "0c031332-b9f4-4e40-bda2-783561412352",
    "timestamp": 1763375109293,
    "type": "completion",
    "prompt": "",
    "response": "\nTENANT_ID=your-tenant-id-here",
    "language": "shellscript",
    "filePath": ".env.example",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 30
  },
  {
    "id": "66750d4d-d6fd-43ac-a50b-9002ae338e1f",
    "timestamp": 1763375109297,
    "type": "completion",
    "prompt": "",
    "response": "\n# Your Azure AD Tenant ID (found in Azure Portal > Azure Active Directory > Overview)",
    "language": "shellscript",
    "filePath": ".env.example",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 86
  },
  {
    "id": "a3d8c737-1f6e-4b5c-9f54-bd51fd414b24",
    "timestamp": 1763375109298,
    "type": "completion",
    "prompt": "",
    "response": "# Copy this file to .env and fill in your actual values",
    "language": "shellscript",
    "filePath": ".env.example",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 55
  },
  {
    "id": "b61a2c10-6402-45e4-a407-16fb03f18b0e",
    "timestamp": 1763375120586,
    "type": "completion",
    "prompt": "",
    "response": "export TENANT_ID=\"your-tenant-id\"\nexport API_AUDIENCE=\"your-client-id\"",
    "language": "shellscript",
    "filePath": "/response_a301381a-44e8-41ea-a9ce-efa7e73f488c/1",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 70
  },
  {
    "id": "9070d744-5fa9-40cd-b27f-fffbbd92dbcc",
    "timestamp": 1763375121499,
    "type": "completion",
    "prompt": "export TENANT_ID=\"your-tenant-",
    "response": "id\"\nexport API_AUDIENCE=",
    "language": "shellscript",
    "filePath": "/response_a301381a-44e8-41ea-a9ce-efa7e73f488c/1",
    "accepted": true,
    "latency": 53,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 24
  },
  {
    "id": "152c555c-920f-481b-a7b5-5fac740718d9",
    "timestamp": 1763375127912,
    "type": "completion",
    "prompt": "",
    "response": "import os\nimport json\nfrom typing import Dict, Any, Optional\nfrom cachetools import TTLCache\nfrom jose import jwt, JWTError\nfrom jose.exceptions import ExpiredSignatureError, JWTClaimsError\nimport httpx\nimport asyncio\n\n# Cache for storing JWKS keys (Time-To-Live cache with 1 hour expiration)\njwks_cache = TTLCache(maxsize=1, ttl=3600)\n\nasync def fetch_jwks(tenant_id: str) -> Dict[str, Any]:\n    \"\"\"\n    Fetch JWKS (JSON Web Key Set) from Microsoft Entra ID discovery endpoint.\n    \n    Args:\n        tenant_id: The Azure AD tenant ID\n        \n    Returns:\n        Dictionary containing the JWKS\n    \"\"\"\n    jwks_url = f\"https://login.microsoftonline.com/{tenant_id}/discovery/v2.0/keys\"\n    \n    # Check cache first\n    if \"jwks\" in jwks_cache:\n        return jwks_cache[\"jwks\"]\n    \n    async with httpx.AsyncClient() as client:\n        try:\n            response = await client.get(jwks_url)\n            response.raise_for_status()\n            jwks = response.json()\n            \n            # Cache the JWKS for 1 hour\n            jwks_cache[\"jwks\"] = jwks\n            return jwks\n            \n        except httpx.HTTPError as e:\n            raise Exception(f\"Failed to fetch JWKS: {str(e)}\")\n\ndef get_signing_key(jwks: Dict[str, Any], kid: str) -> Optional[str]:\n    \"\"\"\n    Extract the signing key from JWKS for a given key ID.\n    \n    Args:\n        jwks: The JSON Web Key Set\n        kid: Key ID from the JWT header\n        \n    Returns:\n        The signing key or None if not found\n    \"\"\"\n    for key in jwks.get(\"keys\", []):\n        if key.get(\"kid\") == kid:\n            # Return the key in PEM format for RSA keys\n            if key.get(\"kty\") == \"RSA\":\n                return key\n    return None\n\nasync def verify_jwt(token: str) -> Dict[str, Any]:\n    \"\"\"\n    Verify and decode a JWT token from Microsoft Entra ID.\n    \n    Args:\n        token: The JWT token to verify\n        \n    Returns:\n        Decoded JWT claims\n        \n    Raises:\n        Exception: If token is invalid, expired, or verification fails\n    \"\"\"\n    # Get configuration from environment variables\n    tenant_id = os.getenv(\"TENANT_ID\")\n    api_audience = os.getenv(\"API_AUDIENCE\") or os.getenv(\"CLIENT_ID\")\n    \n    if not tenant_id:\n        raise Exception(\"TENANT_ID environment variable is required\")\n    \n    if not api_audience:\n        raise Exception(\"API_AUDIENCE (or CLIENT_ID) environment variable is required\")\n    \n    try:\n        # Decode the token header to get the key ID\n        unverified_header = jwt.get_unverified_header(token)\n        kid = unverified_header.get(\"kid\")\n        \n        if not kid:\n            raise Exception(\"Token header missing 'kid' (Key ID)\")\n        \n        # Fetch JWKS from Microsoft\n        jwks = await fetch_jwks(tenant_id)\n        \n        # Get the signing key\n        signing_key = get_signing_key(jwks, kid)\n        if not signing_key:\n            raise Exception(f\"Signing key not found for kid: {kid}\")\n        \n        # Verify and decode the token\n        # Expected issuer for Azure AD v2.0 tokens\n        expected_issuer = f\"https://login.microsoftonline.com/{tenant_id}/v2.0\"\n        \n        decoded_token = jwt.decode(\n            token,\n            signing_key,\n            algorithms=[\"RS256\"],\n            audience=api_audience,\n            issuer=expected_issuer,\n            options={\n                \"verify_signature\": True,\n                \"verify_aud\": True,\n                \"verify_iss\": True,\n                \"verify_exp\": True,\n                \"verify_nbf\": True,\n                \"verify_iat\": True,\n                \"require_aud\": True,\n                \"require_iss\": True,\n                \"require_exp\": True\n            }\n        )\n        \n        return decoded_token\n        \n    except ExpiredSignatureError:\n        raise Exception(\"Token has expired\")\n    except JWTClaimsError as e:\n        raise Exception(f\"Token claims validation failed: {str(e)}\")\n    except JWTError as e:\n        raise Exception(f\"Token validation failed: {str(e)}\")\n    except Exception as e:\n        raise Exception(f\"Token verification error: {str(e)}\")\n\ndef has_required_role(claims: Dict[str, Any], required_role: str) -> bool:\n    \"\"\"\n    Check if the user has a required role in their JWT claims.\n    \n    Args:\n        claims: Decoded JWT claims\n        required_role: The role to check for\n        \n    Returns:\n        True if user has the required role, False otherwise\n    \"\"\"\n    # Roles can be in different claim types depending on token type\n    roles = claims.get(\"roles\", [])  # App roles\n    if not roles:\n        roles = claims.get(\"groups\", [])  # Group memberships\n    \n    return required_role in roles if roles else False",
    "language": "python",
    "filePath": "/Users/madhveshs/Documents/Work/apike-sso-backend/auth.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 4690
  },
  {
    "id": "a66f4430-c1aa-4641-960d-0f062f5c48f9",
    "timestamp": 1763375127947,
    "type": "completion",
    "prompt": "",
    "response": "from fastapi import FastAPI, Depends, HTTPException, status\nfrom fastapi.security import HTTPBearer, HTTPAuthorizationCredentials\nfrom typing import Dict, Any\nimport logging\nfrom auth import verify_jwt, has_required_role\n\n# Configure logging\nlogging.basicConfig(level=logging.INFO)\nlogger = logging.getLogger(__name__)\n\n# Create FastAPI app\napp = FastAPI(\n    title=\"Microsoft Entra ID JWT Auth API\",\n    description=\"A minimal FastAPI application with Microsoft Entra (Azure AD) JWT validation\",\n    version=\"1.0.0\"\n)\n\n# Security scheme for Bearer token\nsecurity = HTTPBearer()\n\nasync def get_current_user(credentials: HTTPAuthorizationCredentials = Depends(security)) -> Dict[str, Any]:\n    \"\"\"\n    Dependency to extract and verify JWT token from Authorization header.\n    \n    Args:\n        credentials: HTTP authorization credentials containing Bearer token\n        \n    Returns:\n        Decoded JWT claims\n        \n    Raises:\n        HTTPException: 401 if token is missing or invalid\n    \"\"\"\n    if not credentials or not credentials.credentials:\n        raise HTTPException(\n            status_code=status.HTTP_401_UNAUTHORIZED,\n            detail=\"Authorization header missing or invalid\",\n            headers={\"WWW-Authenticate\": \"Bearer\"},\n        )\n    \n    token = credentials.credentials\n    \n    try:\n        # Verify the JWT token\n        claims = await verify_jwt(token)\n        logger.info(f\"Successfully authenticated user: {claims.get('preferred_username', 'unknown')}\")\n        return claims\n        \n    except Exception as e:\n        logger.error(f\"Token verification failed: {str(e)}\")\n        raise HTTPException(\n            status_code=status.HTTP_401_UNAUTHORIZED,\n            detail=f\"Token validation failed: {str(e)}\",\n            headers={\"WWW-Authenticate\": \"Bearer\"},\n        )\n\nasync def require_approver_role(current_user: Dict[str, Any] = Depends(get_current_user)) -> Dict[str, Any]:\n    \"\"\"\n    Dependency that requires the user to have \"approver\" role.\n    \n    Args:\n        current_user: Current authenticated user claims\n        \n    Returns:\n        User claims if authorized\n        \n    Raises:\n        HTTPException: 403 if user doesn't have required role\n    \"\"\"\n    if not has_required_role(current_user, \"approver\"):\n        raise HTTPException(\n            status_code=status.HTTP_403_FORBIDDEN,\n            detail=\"Access denied: 'approver' role required\"\n        )\n    \n    return current_user\n\n@app.get(\"/health\")\nasync def health_check():\n    \"\"\"\n    Health check endpoint - no authentication required.\n    \n    Returns:\n        Simple health status\n    \"\"\"\n    return {\"ok\": True}\n\n@app.get(\"/api/profile\")\nasync def get_profile(current_user: Dict[str, Any] = Depends(get_current_user)):\n    \"\"\"\n    Protected endpoint that returns user profile information from JWT claims.\n    Requires valid Bearer JWT token in Authorization header.\n    \n    Args:\n        current_user: Authenticated user claims from JWT\n        \n    Returns:\n        User profile information extracted from JWT claims\n    \"\"\"\n    # Extract useful profile information from claims\n    profile = {\n        \"user_id\": current_user.get(\"sub\"),\n        \"email\": current_user.get(\"email\") or current_user.get(\"preferred_username\"),\n        \"name\": current_user.get(\"name\"),\n        \"given_name\": current_user.get(\"given_name\"),\n        \"family_name\": current_user.get(\"family_name\"),\n        \"roles\": current_user.get(\"roles\", []),\n        \"tenant_id\": current_user.get(\"tid\"),\n        \"app_id\": current_user.get(\"appid\"),\n        \"scope\": current_user.get(\"scp\"),\n    }\n    \n    # Remove None values for cleaner response\n    profile = {k: v for k, v in profile.items() if v is not None}\n    \n    return {\n        \"message\": \"Profile retrieved successfully\",\n        \"profile\": profile,\n        \"raw_claims\": current_user  # Include all claims for debugging\n    }\n\n@app.get(\"/api/admin-only\")\nasync def admin_only_endpoint(current_user: Dict[str, Any] = Depends(require_approver_role)):\n    \"\"\"\n    Protected endpoint that requires \"approver\" role.\n    Only users with \"approver\" role in their JWT can access this endpoint.\n    \n    Args:\n        current_user: Authenticated user claims (must have \"approver\" role)\n        \n    Returns:\n        Admin-specific information\n    \"\"\"\n    return {\n        \"message\": \"Welcome to the admin area!\",\n        \"user\": {\n            \"email\": current_user.get(\"email\") or current_user.get(\"preferred_username\"),\n            \"name\": current_user.get(\"name\"),\n            \"roles\": current_user.get(\"roles\", [])\n        },\n        \"admin_info\": {\n            \"access_level\": \"administrator\",\n            \"permissions\": [\"read\", \"write\", \"delete\", \"approve\"]\n        }\n    }\n\n@app.exception_handler(Exception)\nasync def global_exception_handler(request, exc):\n    \"\"\"\n    Global exception handler for unhandled exceptions.\n    \"\"\"\n    logger.error(f\"Unhandled exception: {str(exc)}\")\n    return HTTPException(\n        status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n        detail=\"Internal server error\"\n    )\n\nif __name__ == \"__main__\":\n    import uvicorn\n    uvicorn.run(app, host=\"0.0.0.0\", port=8000, reload=True)",
    "language": "python",
    "filePath": "/Users/madhveshs/Documents/Work/apike-sso-backend/main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 5173
  },
  {
    "id": "71611e00-a6c1-4c18-98a7-f78ade2efa99",
    "timestamp": 1763375127972,
    "type": "completion",
    "prompt": "",
    "response": "# FastAPI Microsoft Entra ID JWT Authentication\n\nA minimal FastAPI application that validates Microsoft Entra (Azure AD) access tokens using JWKS (JSON Web Key Set).\n\n## Features\n\n- JWT token validation using Microsoft Entra ID JWKS\n- JWKS caching for improved performance\n- Role-based access control\n- Three endpoints:\n  - `/health` - Public health check\n  - `/api/profile` - Protected profile endpoint (requires valid JWT)\n  - `/api/admin-only` - Admin endpoint (requires \"approver\" role)\n\n## Prerequisites\n\n- Python 3.8+\n- Microsoft Entra ID (Azure AD) tenant\n- Registered application in Azure AD\n\n## Environment Variables\n\nYou need to set the following environment variables:\n\n### Required Variables\n\n1. **TENANT_ID**: Your Azure AD tenant ID\n   - Find this in Azure Portal  Azure Active Directory  Overview  Tenant ID\n   - Example: `12345678-1234-1234-1234-123456789012`\n\n2. **API_AUDIENCE** (or **CLIENT_ID**): Your application's client ID or audience\n   - Find this in Azure Portal  App registrations  Your App  Overview  Application (client) ID\n   - Example: `87654321-4321-4321-4321-210987654321`\n\n### Setting Environment Variables\n\n#### Option 1: Export in terminal (temporary)\n```bash\nexport TENANT_ID=\"your-tenant-id-here\"\nexport API_AUDIENCE=\"your-client-id-here\"\n```\n\n#### Option 2: Create .env file (recommended)\nCreate a `.env` file in the project root:\n```bash\nTENANT_ID=your-tenant-id-here\nAPI_AUDIENCE=your-client-id-here\n```\n\nThen install python-dotenv and load it in your application:\n```bash\npip install python-dotenv\n```\n\n## Installation\n\n1. **Clone or create the project directory**\n\n2. **Install dependencies**:\n   ```bash\n   pip install fastapi uvicorn python-jose[cryptography] httpx cachetools\n   ```\n\n3. **Set environment variables** (see above)\n\n4. **Run the application**:\n   ```bash\n   uvicorn main:app --reload\n   ```\n\nThe API will be available at `http://localhost:8000`\n\n## API Documentation\n\nOnce running, visit:\n- **Interactive API docs**: `http://localhost:8000/docs`\n- **ReDoc documentation**: `http://localhost:8000/redoc`\n\n## Endpoints\n\n### 1. Health Check (Public)\n```bash\nGET /health\n```\nReturns: `{\"ok\": true}`\n\n### 2. User Profile (Protected)\n```bash\nGET /api/profile\nAuthorization: Bearer <your-jwt-token>\n```\nReturns user profile information from JWT claims.\n\n### 3. Admin Only (Role-Protected)\n```bash\nGET /api/admin-only\nAuthorization: Bearer <your-jwt-token>\n```\nRequires \"approver\" role in JWT token.\n\n## Testing with JWT Tokens\n\n### Getting a JWT Token\n\n1. **From Azure AD**: Use Azure CLI, PowerShell, or your application's login flow\n2. **For testing**: You can use tools like Postman with Azure AD OAuth2 flow\n\n### Example using curl\n```bash\n# Health check (no auth required)\ncurl http://localhost:8000/health\n\n# Profile endpoint (requires JWT)\ncurl -H \"Authorization: Bearer YOUR_JWT_TOKEN\" \\\n     http://localhost:8000/api/profile\n\n# Admin endpoint (requires JWT with \"approver\" role)\ncurl -H \"Authorization: Bearer YOUR_JWT_TOKEN\" \\\n     http://localhost:8000/api/admin-only\n```\n\n## File Structure\n\n- `auth.py` - JWT verification logic and JWKS handling\n- `main.py` - FastAPI application with endpoints and middleware\n- `README.md` - This documentation\n\n## Configuration Details\n\n### Azure AD App Registration\n\nYour Azure AD application should be configured with:\n\n1. **Authentication**: Configure redirect URIs if using interactive flows\n2. **API permissions**: Grant necessary Microsoft Graph permissions if needed\n3. **App roles** (optional): Define custom roles like \"approver\" for role-based access\n4. **Token configuration**: Ensure proper claims are included in tokens\n\n### JWT Token Claims\n\nThe application expects standard Azure AD v2.0 token claims:\n- `sub`: Subject (user ID)\n- `aud`: Audience (should match your API_AUDIENCE)\n- `iss`: Issuer (Azure AD)\n- `exp`: Expiration time\n- `roles`: Array of assigned roles (for role-based access)\n- `preferred_username`: User's email/username\n- `name`: User's display name\n\n## Security Features\n\n- **Token signature verification** using RSA256 and JWKS\n- **Token expiration validation**\n- **Audience and issuer validation**\n- **JWKS caching** (1 hour TTL) for performance\n- **Role-based access control**\n- **Comprehensive error handling**\n\n## Troubleshooting\n\n### Common Issues\n\n1. **\"TENANT_ID environment variable is required\"**\n   - Set the TENANT_ID environment variable\n\n2. **\"API_AUDIENCE environment variable is required\"**\n   - Set either API_AUDIENCE or CLIENT_ID environment variable\n\n3. **\"Token validation failed\"**\n   - Check that your JWT token is valid and not expired\n   - Verify TENANT_ID and API_AUDIENCE match your Azure AD configuration\n\n4. **\"Access denied: 'approver' role required\"**\n   - User needs \"approver\" role assigned in Azure AD\n   - Check App roles configuration in Azure Portal\n\n### Logs\n\nThe application logs authentication events. Check console output for detailed error messages.\n\n## Development\n\nTo run in development mode with auto-reload:\n```bash\nuvicorn main:app --reload --log-level debug\n```\n\n## Production Considerations\n\n- Use environment variables or secure configuration management\n- Enable HTTPS in production\n- Consider rate limiting and additional security middleware\n- Monitor and log security events\n- Regular security updates for dependencies",
    "language": "markdown",
    "filePath": "/Users/madhveshs/Documents/Work/apike-sso-backend/README.md",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 5311
  },
  {
    "id": "6551305b-c1e7-4f5b-a97b-3efa6016cc61",
    "timestamp": 1763375128054,
    "type": "completion",
    "prompt": "",
    "response": "fastapi==0.104.1\nuvicorn[standard]==0.24.0\npython-jose[cryptography]==3.3.0\nhttpx==0.25.2\ncachetools==5.3.2",
    "language": "pip-requirements",
    "filePath": "/Users/madhveshs/Documents/Work/apike-sso-backend/requirements.txt",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 107
  },
  {
    "id": "2ae20981-cdd7-4258-9d43-2159847f1676",
    "timestamp": 1763375128069,
    "type": "completion",
    "prompt": "",
    "response": "# Copy this file to .env and fill in your actual values\n\n# Your Azure AD Tenant ID (found in Azure Portal > Azure Active Directory > Overview)\nTENANT_ID=your-tenant-id-here\n\n# Your application's Client ID or API Audience (found in App registrations > Your App > Overview)\nAPI_AUDIENCE=your-client-id-here\n\n# Alternative: You can use CLIENT_ID instead of API_AUDIENCE\n# CLIENT_ID=your-client-id-here",
    "language": "shellscript",
    "filePath": "/Users/madhveshs/Documents/Work/apike-sso-backend/.env.example",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 398
  },
  {
    "id": "e1b1965e-22f9-4906-8ef5-5ce5962213f2",
    "timestamp": 1763381367007,
    "type": "completion",
    "prompt": "",
    "response": "from fastapi import FastAPI, Depends, HTTPException, status, Request\nfrom fastapi.responses import JSONResponse\nfrom fastapi.security import HTTPBearer, HTTPAuthorizationCredentials\nfrom fastapi.middleware.cors import CORSMiddleware\nfrom typing import Dict, Any\nimport logging\nfrom auth import verify_jwt, has_required_role\n\n# Configure logging\nlogging.basicConfig(level=logging.INFO)\nlogger = logging.getLogger(__name__)\n\n# Create FastAPI app\napp = FastAPI(\n    title=\"Microsoft Entra ID JWT Auth API\",\n    description=\"A minimal FastAPI application with Microsoft Entra (Azure AD) JWT validation\",\n    version=\"1.0.0\"\n)\n\n# CORS - allow the SPA dev server to call the API\napp.add_middleware(\n    CORSMiddleware,\n    allow_origins=[\"http://localhost:5173\"],  # or [\"*\"] for dev convenience\n    allow_credentials=True,\n    allow_methods=[\"*\"],\n    allow_headers=[\"*\"],\n)\n\n# Simple request logger middleware to confirm requests reach backend\n@app.middleware(\"http\")\nasync def log_requests(request: Request, call_next):\n    logger.info(f\"Incoming request: {request.method} {request.url.path} from {request.client.host}\")\n    # Optionally log Authorization header presence (do not log token contents in prod)\n    if \"authorization\" in request.headers:\n        logger.info(\"Authorization header present\")\n    response = await call_next(request)\n    logger.info(f\"Response status: {response.status_code} for {request.method} {request.url.path}\")\n    return response\n\n# Security scheme for Bearer token\nsecurity = HTTPBearer()\n\nasync def get_current_user(credentials: HTTPAuthorizationCredentials = Depends(security)) -> Dict[str, Any]:\n    if not credentials or not credentials.credentials:\n        raise HTTPException(\n            status_code=status.HTTP_401_UNAUTHORIZED,\n            detail=\"Authorization header missing or invalid\",\n            headers={\"WWW-Authenticate\": \"Bearer\"},\n        )\n\n    token = credentials.credentials\n\n    try:\n        claims = await verify_jwt(token)\n        # Use preferred_username/email if available -- good for logs\n        logger.info(f\"Successfully authenticated user: {claims.get('preferred_username', 'unknown')}\")\n        return claims\n\n    except Exception as e:\n        logger.error(f\"Token verification failed: {str(e)}\")\n        raise HTTPException(\n            status_code=status.HTTP_401_UNAUTHORIZED,\n            detail=\"Token validation failed\",\n            headers={\"WWW-Authenticate\": \"Bearer\"},\n        )\n\nasync def require_approver_role(current_user: Dict[str, Any] = Depends(get_current_user)) -> Dict[str, Any]:\n    if not has_required_role(current_user, \"approver\"):\n        raise HTTPException(\n            status_code=status.HTTP_403_FORBIDDEN,\n            detail=\"Access denied: 'approver' role required\"\n        )\n    return current_user\n\n@app.get(\"/health\")\nasync def health_check():\n    return {\"ok\": True}\n\n@app.get(\"/api/profile\")\nasync def get_profile(current_user: Dict[str, Any] = Depends(get_current_user)):\n    profile = {\n        \"user_id\": current_user.get(\"sub\"),\n        \"email\": current_user.get(\"email\") or current_user.get(\"preferred_username\"),\n        \"name\": current_user.get(\"name\"),\n        \"given_name\": current_user.get(\"given_name\"),\n        \"family_name\": current_user.get(\"family_name\"),\n        \"roles\": current_user.get(\"roles\", []),\n        \"tenant_id\": current_user.get(\"tid\"),\n        \"app_id\": current_user.get(\"appid\"),\n        \"scope\": current_user.get(\"scp\"),\n    }\n    profile = {k: v for k, v in profile.items() if v is not None}\n    return {\n        \"message\": \"Profile retrieved successfully\",\n        \"profile\": profile,\n        \"raw_claims\": current_user\n    }\n\n@app.get(\"/api/admin-only\")\nasync def admin_only_endpoint(current_user: Dict[str, Any] = Depends(require_approver_role)):\n    return {\n        \"message\": \"Welcome to the admin area!\",\n        \"user\": {\n            \"email\": current_user.get(\"email\") or current_user.get(\"preferred_username\"),\n            \"name\": current_user.get(\"name\"),\n            \"roles\": current_user.get(\"roles\", [])\n        },\n        \"admin_info\": {\n            \"access_level\": \"administrator\",\n            \"permissions\": [\"read\", \"write\", \"delete\", \"approve\"]\n        }\n    }\n\n@app.exception_handler(Exception)\nasync def global_exception_handler(request: Request, exc: Exception):\n    logger.exception(f\"Unhandled exception for {request.method} {request.url.path}: {exc}\")\n    return JSONResponse(\n        status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n        content={\"detail\": \"Internal server error\"}\n    )\n\nif __name__ == \"__main__\":\n    import uvicorn\n    uvicorn.run(app, host=\"0.0.0.0\", port=8000, reload=True)\n",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 4658
  },
  {
    "id": "9e6dc796-39e5-4306-b4db-c8e040409ea6",
    "timestamp": 1763381367016,
    "type": "completion",
    "prompt": "",
    "response": "from fastapi import FastAPI, Depends, HTTPException, status, Request\nfrom fastapi.responses import JSONResponse\nfrom fastapi.security import HTTPBearer, HTTPAuthorizationCredentials\nfrom fastapi.middleware.cors import CORSMiddleware\nfrom typing import Dict, Any\nimport logging\nfrom auth import verify_jwt, has_required_role\n\n# Configure logging\nlogging.basicConfig(level=logging.INFO)\nlogger = logging.getLogger(__name__)\n\n# Create FastAPI app\napp = FastAPI(\n    title=\"Microsoft Entra ID JWT Auth API\",\n    description=\"A minimal FastAPI application with Microsoft Entra (Azure AD) JWT validation\",\n    version=\"1.0.0\"\n)\n\n# CORS - allow the SPA dev server to call the API\napp.add_middleware(\n    CORSMiddleware,\n    allow_origins=[\"http://localhost:5173\"],  # or [\"*\"] for dev convenience\n    allow_credentials=True,\n    allow_methods=[\"*\"],\n    allow_headers=[\"*\"],\n)\n\n# Simple request logger middleware to confirm requests reach backend\n@app.middleware(\"http\")\nasync def log_requests(request: Request, call_next):\n    logger.info(f\"Incoming request: {request.method} {request.url.path} from {request.client.host}\")\n    # Optionally log Authorization header presence (do not log token contents in prod)\n    if \"authorization\" in request.headers:\n        logger.info(\"Authorization header present\")\n    response = await call_next(request)\n    logger.info(f\"Response status: {response.status_code} for {request.method} {request.url.path}\")\n    return response\n\n# Security scheme for Bearer token\nsecurity = HTTPBearer()\n\nasync def get_current_user(credentials: HTTPAuthorizationCredentials = Depends(security)) -> Dict[str, Any]:\n    if not credentials or not credentials.credentials:\n        raise HTTPException(\n            status_code=status.HTTP_401_UNAUTHORIZED,\n            detail=\"Authorization header missing or invalid\",\n            headers={\"WWW-Authenticate\": \"Bearer\"},\n        )\n\n    token = credentials.credentials\n\n    try:\n        claims = await verify_jwt(token)\n        # Use preferred_username/email if available -- good for logs\n        logger.info(f\"Successfully authenticated user: {claims.get('preferred_username', 'unknown')}\")\n        return claims\n\n    except Exception as e:\n        logger.error(f\"Token verification failed: {str(e)}\")\n        raise HTTPException(\n            status_code=status.HTTP_401_UNAUTHORIZED,\n            detail=\"Token validation failed\",\n            headers={\"WWW-Authenticate\": \"Bearer\"},\n        )\n\nasync def require_approver_role(current_user: Dict[str, Any] = Depends(get_current_user)) -> Dict[str, Any]:\n    if not has_required_role(current_user, \"approver\"):\n        raise HTTPException(\n            status_code=status.HTTP_403_FORBIDDEN,\n            detail=\"Access denied: 'approver' role required\"\n        )\n    return current_user\n\n@app.get(\"/health\")\nasync def health_check():\n    return {\"ok\": True}\n\n@app.get(\"/api/profile\")\nasync def get_profile(current_user: Dict[str, Any] = Depends(get_current_user)):\n    profile = {\n        \"user_id\": current_user.get(\"sub\"),\n        \"email\": current_user.get(\"email\") or current_user.get(\"preferred_username\"),\n        \"name\": current_user.get(\"name\"),\n        \"given_name\": current_user.get(\"given_name\"),\n        \"family_name\": current_user.get(\"family_name\"),\n        \"roles\": current_user.get(\"roles\", []),\n        \"tenant_id\": current_user.get(\"tid\"),\n        \"app_id\": current_user.get(\"appid\"),\n        \"scope\": current_user.get(\"scp\"),\n    }\n    profile = {k: v for k, v in profile.items() if v is not None}\n    return {\n        \"message\": \"Profile retrieved successfully\",\n        \"profile\": profile,\n        \"raw_claims\": current_user\n    }\n\n@app.get(\"/api/admin-only\")\nasync def admin_only_endpoint(current_user: Dict[str, Any] = Depends(require_approver_role)):\n    return {\n        \"message\": \"Welcome to the admin area!\",\n        \"user\": {\n            \"email\": current_user.get(\"email\") or current_user.get(\"preferred_username\"),\n            \"name\": current_user.get(\"name\"),\n            \"roles\": current_user.get(\"roles\", [])\n        },\n        \"admin_info\": {\n            \"access_level\": \"administrator\",\n            \"permissions\": [\"read\", \"write\", \"delete\", \"approve\"]\n        }\n    }\n\n@app.exception_handler(Exception)\nasync def global_exception_handler(request: Request, exc: Exception):\n    logger.exception(f\"Unhandled exception for {request.method} {request.url.path}: {exc}\")\n    return JSONResponse(\n        status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n        content={\"detail\": \"Internal server error\"}\n    )\n\nif __name__ == \"__main__\":\n    import uvicorn\n    uvicorn.run(app, host=\"0.0.0.0\", port=8000, reload=True)\n",
    "language": "python",
    "filePath": "/Users/madhveshs/Documents/Work/apike-sso-backend/main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 4658
  },
  {
    "id": "b9844c66-bcdc-4479-8feb-53866d2a040f",
    "timestamp": 1763383255278,
    "type": "completion",
    "prompt": "import React from 'react';\nimport { useMsal } from '@azure/msal-react';\nimport { interactiveLogin } from '../auth/msalClient';",
    "response": "\n\ninterface SessionControlsProps",
    "language": "typescript",
    "filePath": "/response_6d92e7f1-c697-49f1-9494-e1267c8bcbf3/0",
    "accepted": true,
    "latency": 65,
    "modelName": "copilot",
    "lineNumber": 2,
    "characterCount": 32
  },
  {
    "id": "c88b5215-6032-4a50-84f0-07a737e08bbe",
    "timestamp": 1763383257043,
    "type": "completion",
    "prompt": "import React from 'react';\nimport { useMsal } from '@azure/msal-react';\nimport { interactiveLogin } from '../auth/msalClient';\n\ninterface SessionControlsProps {\n  scopes?: string[];\n}\n\nexport const SessionControls: React.FC<SessionControlsProps> = ({ \n  scopes = ['openid', 'profile', 'email'] \n}) => {\n  const { instance, accounts } = useMsal();\n  const isAuthenticated = accounts.length > 0;\n\n  const handleLogin = async () => {\n    try {",
    "response": "\n      await interactiveLogin(scopes);",
    "language": "typescript",
    "filePath": "/response_6d92e7f1-c697-49f1-9494-e1267c8bcbf3/0",
    "accepted": true,
    "latency": 67,
    "modelName": "copilot",
    "lineNumber": 15,
    "characterCount": 38
  },
  {
    "id": "e0cfeb65-5351-442c-beb7-d7d1094d8613",
    "timestamp": 1763383257242,
    "type": "completion",
    "prompt": "import React from 'react';\nimport { useMsal } from '@azure/msal-react';\nimport { interactiveLogin } from '../auth/msalClient';\n\ninterface SessionControlsProps {\n  scopes?: string[];\n}\n\nexport const SessionControls: React.FC<SessionControlsProps> = ({ \n  scopes = ['openid', 'profile', 'email'] \n}) => {\n  const { instance, accounts } = useMsal();\n  const isAuthenticated = accounts.length > 0;\n\n  const handleLogin = async () => {\n    try {\n      await interactiveLogin(scopes);\n    } catch (error) {",
    "response": "\n      console.error('Login",
    "language": "typescript",
    "filePath": "/response_6d92e7f1-c697-49f1-9494-e1267c8bcbf3/0",
    "accepted": true,
    "latency": 32,
    "modelName": "copilot",
    "lineNumber": 17,
    "characterCount": 27
  },
  {
    "id": "bb84445c-bf5c-476e-af64-2fe2d9fd489a",
    "timestamp": 1763383257803,
    "type": "completion",
    "prompt": "import React from 'react';\nimport { useMsal } from '@azure/msal-react';\nimport { interactiveLogin } from '../auth/msalClient';\n\ninterface SessionControlsProps {\n  scopes?: string[];\n}\n\nexport const SessionControls: React.FC<SessionControlsProps> = ({ \n  scopes = ['openid', 'profile', 'email'] \n}) => {\n  const { instance, accounts } = useMsal();\n  const isAuthenticated = accounts.length > 0;\n\n  const handleLogin = async () => {\n    try {\n      await interactiveLogin(scopes);\n    } catch (error) {\n      console.error('Login failed:', error);\n    }\n  };\n\n  const handleLogout = () => {",
    "response": "\n    instance.logoutRedirect({",
    "language": "typescript",
    "filePath": "/response_6d92e7f1-c697-49f1-9494-e1267c8bcbf3/0",
    "accepted": true,
    "latency": 40,
    "modelName": "copilot",
    "lineNumber": 22,
    "characterCount": 30
  },
  {
    "id": "620ebbb1-16b2-46d9-b992-71f67cb2e052",
    "timestamp": 1763383257842,
    "type": "completion",
    "prompt": "import React from 'react';\nimport { useMsal } from '@azure/msal-react';\nimport { interactiveLogin } from '../auth/msalClient';\n\ninterface SessionControlsProps {\n  scopes?: string[];\n}\n\nexport const SessionControls: React.FC<SessionControlsProps> = ({ \n  scopes = ['openid', 'profile', 'email'] \n}) => {\n  const { instance, accounts } = useMsal();\n  const isAuthenticated = accounts.length > 0;\n\n  const handleLogin = async () => {\n    try {\n      await interactiveLogin(scopes);\n    } catch (error) {\n      console.error('Login failed:', error);\n    }\n  };\n\n  const handleLogout = () => {\n    instance.logoutRedirect({",
    "response": "\n      postLogoutRedirectUri:",
    "language": "typescript",
    "filePath": "/response_6d92e7f1-c697-49f1-9494-e1267c8bcbf3/0",
    "accepted": true,
    "latency": 38,
    "modelName": "copilot",
    "lineNumber": 23,
    "characterCount": 29
  },
  {
    "id": "dc559d88-4cfc-4999-9c36-39f95f727cd4",
    "timestamp": 1763383258350,
    "type": "completion",
    "prompt": "import React from 'react';\nimport { useMsal } from '@azure/msal-react';\nimport { interactiveLogin } from '../auth/msalClient';\n\ninterface SessionControlsProps {\n  scopes?: string[];\n}\n\nexport const SessionControls: React.FC<SessionControlsProps> = ({ \n  scopes = ['openid', 'profile', 'email'] \n}) => {\n  const { instance, accounts } = useMsal();\n  const isAuthenticated = accounts.length > 0;\n\n  const handleLogin = async () => {\n    try {\n      await interactiveLogin(scopes);\n    } catch (error) {\n      console.error('Login failed:', error);\n    }\n  };\n\n  const handleLogout = () => {\n    instance.logoutRedirect({\n      postLogoutRedirectUri: window.location.origin,\n    });\n  };\n\n  return (\n    <div className=\"session-controls\">",
    "response": "\n      {isAuthenticated",
    "language": "typescript",
    "filePath": "/response_6d92e7f1-c697-49f1-9494-e1267c8bcbf3/0",
    "accepted": true,
    "latency": 52,
    "modelName": "copilot",
    "lineNumber": 29,
    "characterCount": 23
  },
  {
    "id": "815f52bf-32ae-4802-80c6-04356619b7a1",
    "timestamp": 1763383258527,
    "type": "completion",
    "prompt": "import React from 'react';\nimport { useMsal } from '@azure/msal-react';\nimport { interactiveLogin } from '../auth/msalClient';\n\ninterface SessionControlsProps {\n  scopes?: string[];\n}\n\nexport const SessionControls: React.FC<SessionControlsProps> = ({ \n  scopes = ['openid', 'profile', 'email'] \n}) => {\n  const { instance, accounts } = useMsal();\n  const isAuthenticated = accounts.length > 0;\n\n  const handleLogin = async () => {\n    try {\n      await interactiveLogin(scopes);\n    } catch (error) {\n      console.error('Login failed:', error);\n    }\n  };\n\n  const handleLogout = () => {\n    instance.logoutRedirect({\n      postLogoutRedirectUri: window.location.origin,\n    });\n  };\n\n  return (\n    <div className=\"session-controls\">\n      {isAuthenticated ? (\n        <div>",
    "response": "\n          <span>Welcome,",
    "language": "typescript",
    "filePath": "/response_6d92e7f1-c697-49f1-9494-e1267c8bcbf3/0",
    "accepted": true,
    "latency": 35,
    "modelName": "copilot",
    "lineNumber": 31,
    "characterCount": 25
  },
  {
    "id": "39011f45-0b26-43f6-9126-ae969d41c7ed",
    "timestamp": 1763383261300,
    "type": "completion",
    "prompt": "import { useEffect, useRef } from 'react';\nimport { InteractionRequiredAuthError } from '@azure/msal-browser';\nimport { silentAcquireToken, interactiveLogin } from './msalClient';\n\ninterface SessionMonitorProps {\n  monitoredScopes: string[];",
    "response": "\n  refreshBeforeExpirySeconds?:",
    "language": "typescript",
    "filePath": "/response_6d92e7f1-c697-49f1-9494-e1267c8bcbf3/1",
    "accepted": true,
    "latency": 40,
    "modelName": "copilot",
    "lineNumber": 5,
    "characterCount": 31
  },
  {
    "id": "8f668dfc-e2f5-441b-bc7c-3edfbf85ce10",
    "timestamp": 1763383261384,
    "type": "completion",
    "prompt": "import { useEffect, useRef } from 'react';\nimport { InteractionRequiredAuthError } from '@azure/msal-browser';\nimport { silentAcquireToken, interactiveLogin } from './msalClient';\n\ninterface SessionMonitorProps {\n  monitoredScopes: string[];\n  refreshBeforeExpirySeconds?: number;",
    "response": "\n  fallbackIntervalSeconds?:",
    "language": "typescript",
    "filePath": "/response_6d92e7f1-c697-49f1-9494-e1267c8bcbf3/1",
    "accepted": true,
    "latency": 44,
    "modelName": "copilot",
    "lineNumber": 6,
    "characterCount": 28
  },
  {
    "id": "8e2cf02d-2c72-4c16-b36f-f6ed68aa386f",
    "timestamp": 1763383262100,
    "type": "completion",
    "prompt": "import { useEffect, useRef } from 'react';\nimport { InteractionRequiredAuthError } from '@azure/msal-browser';\nimport { silentAcquireToken, interactiveLogin } from './msalClient';\n\ninterface SessionMonitorProps {\n  monitoredScopes: string[];\n  refreshBeforeExpirySeconds?: number;\n  fallbackIntervalSeconds?: number;\n}\n\n// Global redirect guard to prevent multiple concurrent redirects\ndeclare global {\n  interface Window {",
    "response": "\n    __isRedirectingToLogin?:",
    "language": "typescript",
    "filePath": "/response_6d92e7f1-c697-49f1-9494-e1267c8bcbf3/1",
    "accepted": true,
    "latency": 41,
    "modelName": "copilot",
    "lineNumber": 12,
    "characterCount": 29
  },
  {
    "id": "5cadf9d4-088d-47a1-b0c0-1ba68eb76a05",
    "timestamp": 1763383262538,
    "type": "completion",
    "prompt": "import { useEffect, useRef } from 'react';\nimport { InteractionRequiredAuthError } from '@azure/msal-browser';\nimport { silentAcquireToken, interactiveLogin } from './msalClient';\n\ninterface SessionMonitorProps {\n  monitoredScopes: string[];\n  refreshBeforeExpirySeconds?: number;\n  fallbackIntervalSeconds?: number;\n}\n\n// Global redirect guard to prevent multiple concurrent redirects\ndeclare global {\n  interface Window {\n    __isRedirectingToLogin?: boolean;\n  }\n}\n\nexport const SessionMonitor: React.FC<SessionMonitorProps> = ({\n  monitoredScopes,",
    "response": "\n  refreshBeforeExpirySeconds",
    "language": "typescript",
    "filePath": "/response_6d92e7f1-c697-49f1-9494-e1267c8bcbf3/1",
    "accepted": true,
    "latency": 37,
    "modelName": "copilot",
    "lineNumber": 18,
    "characterCount": 29
  },
  {
    "id": "682d6ae4-521c-481f-9a9c-e34fcb22b046",
    "timestamp": 1763383262658,
    "type": "completion",
    "prompt": "import { useEffect, useRef } from 'react';\nimport { InteractionRequiredAuthError } from '@azure/msal-browser';\nimport { silentAcquireToken, interactiveLogin } from './msalClient';\n\ninterface SessionMonitorProps {\n  monitoredScopes: string[];\n  refreshBeforeExpirySeconds?: number;\n  fallbackIntervalSeconds?: number;\n}\n\n// Global redirect guard to prevent multiple concurrent redirects\ndeclare global {\n  interface Window {\n    __isRedirectingToLogin?: boolean;\n  }\n}\n\nexport const SessionMonitor: React.FC<SessionMonitorProps> = ({\n  monitoredScopes,\n  refreshBeforeExpirySeconds = 60,",
    "response": "\n  fallbackIntervalSeconds",
    "language": "typescript",
    "filePath": "/response_6d92e7f1-c697-49f1-9494-e1267c8bcbf3/1",
    "accepted": true,
    "latency": 36,
    "modelName": "copilot",
    "lineNumber": 19,
    "characterCount": 26
  },
  {
    "id": "7fa43eb4-fbd8-432f-8702-1bead6d3f577",
    "timestamp": 1763383263817,
    "type": "completion",
    "prompt": "import { useEffect, useRef } from 'react';\nimport { InteractionRequiredAuthError } from '@azure/msal-browser';\nimport { silentAcquireToken, interactiveLogin } from './msalClient';\n\ninterface SessionMonitorProps {\n  monitoredScopes: string[];\n  refreshBeforeExpirySeconds?: number;\n  fallbackIntervalSeconds?: number;\n}\n\n// Global redirect guard to prevent multiple concurrent redirects\ndeclare global {\n  interface Window {\n    __isRedirectingToLogin?: boolean;\n  }\n}\n\nexport const SessionMonitor: React.FC<SessionMonitorProps> = ({\n  monitoredScopes,\n  refreshBeforeExpirySeconds = 60,\n  fallbackIntervalSeconds = 60,\n}) => {\n  const timeoutRef = useRef<NodeJS.Timeout | null>(null);\n  const isMountedRef = useRef(true);\n\n  const scheduleTokenRefresh = async () => {\n    if (!isMountedRef.current) return;\n\n    try {",
    "response": "\n      console.log('[SessionMonitor]",
    "language": "typescript",
    "filePath": "/response_6d92e7f1-c697-49f1-9494-e1267c8bcbf3/1",
    "accepted": true,
    "latency": 41,
    "modelName": "copilot",
    "lineNumber": 28,
    "characterCount": 36
  },
  {
    "id": "a4c08b7f-af2b-4afa-b7b8-14337620ff1e",
    "timestamp": 1763383265946,
    "type": "completion",
    "prompt": "import { useEffect, useRef } from 'react';\nimport { InteractionRequiredAuthError } from '@azure/msal-browser';\nimport { silentAcquireToken, interactiveLogin } from './msalClient';\n\ninterface SessionMonitorProps {\n  monitoredScopes: string[];\n  refreshBeforeExpirySeconds?: number;\n  fallbackIntervalSeconds?: number;\n}\n\n// Global redirect guard to prevent multiple concurrent redirects\ndeclare global {\n  interface Window {\n    __isRedirectingToLogin?: boolean;\n  }\n}\n\nexport const SessionMonitor: React.FC<SessionMonitorProps> = ({\n  monitoredScopes,\n  refreshBeforeExpirySeconds = 60,\n  fallbackIntervalSeconds = 60,\n}) => {\n  const timeoutRef = useRef<NodeJS.Timeout | null>(null);\n  const isMountedRef = useRef(true);\n\n  const scheduleTokenRefresh = async () => {\n    if (!isMountedRef.current) return;\n\n    try {\n      console.log('[SessionMonitor] Checking token status...');\n      \n      // Attempt silent token acquisition to get current expiry\n      const tokenResponse = await silentAcquireToken(monitoredScopes);\n      \n      if (!isMountedRef.current) return;\n\n      const now = new Date();\n      const expiresOn = tokenResponse.expiresOn;\n      const refreshTime = new Date(expiresOn.getTime() - (refreshBeforeExpirySeconds * 1000));\n      \n      // If token expires very soon, refresh immediately\n      if (refreshTime <= now)",
    "response": " {\n        console.log('[SessionMonitor]",
    "language": "typescript",
    "filePath": "/response_6d92e7f1-c697-49f1-9494-e1267c8bcbf3/1",
    "accepted": true,
    "latency": 74,
    "modelName": "copilot",
    "lineNumber": 41,
    "characterCount": 40
  },
  {
    "id": "7bb4d136-23d9-4692-9163-e41f0ec7bfac",
    "timestamp": 1763383266828,
    "type": "completion",
    "prompt": "import { useEffect, useRef } from 'react';\nimport { InteractionRequiredAuthError } from '@azure/msal-browser';\nimport { silentAcquireToken, interactiveLogin } from './msalClient';\n\ninterface SessionMonitorProps {\n  monitoredScopes: string[];\n  refreshBeforeExpirySeconds?: number;\n  fallbackIntervalSeconds?: number;\n}\n\n// Global redirect guard to prevent multiple concurrent redirects\ndeclare global {\n  interface Window {\n    __isRedirectingToLogin?: boolean;\n  }\n}\n\nexport const SessionMonitor: React.FC<SessionMonitorProps> = ({\n  monitoredScopes,\n  refreshBeforeExpirySeconds = 60,\n  fallbackIntervalSeconds = 60,\n}) => {\n  const timeoutRef = useRef<NodeJS.Timeout | null>(null);\n  const isMountedRef = useRef(true);\n\n  const scheduleTokenRefresh = async () => {\n    if (!isMountedRef.current) return;\n\n    try {\n      console.log('[SessionMonitor] Checking token status...');\n      \n      // Attempt silent token acquisition to get current expiry\n      const tokenResponse = await silentAcquireToken(monitoredScopes);\n      \n      if (!isMountedRef.current) return;\n\n      const now = new Date();\n      const expiresOn = tokenResponse.expiresOn;\n      const refreshTime = new Date(expiresOn.getTime() - (refreshBeforeExpirySeconds * 1000));\n      \n      // If token expires very soon, refresh immediately\n      if (refreshTime <= now) {\n        console.log('[SessionMonitor] Token expires soon, refreshing immediately');\n        await performSilentRefresh();\n      } else {\n        // Schedule refresh before expiry\n        const timeUntilRefresh = refreshTime.getTime() - now.getTime();",
    "response": "\n        console.log(",
    "language": "typescript",
    "filePath": "/response_6d92e7f1-c697-49f1-9494-e1267c8bcbf3/1",
    "accepted": true,
    "latency": 38,
    "modelName": "copilot",
    "lineNumber": 46,
    "characterCount": 21
  },
  {
    "id": "6baa4772-9069-4fd9-b56f-d2a1e658a7ce",
    "timestamp": 1763383267026,
    "type": "completion",
    "prompt": "import { useEffect, useRef } from 'react';\nimport { InteractionRequiredAuthError } from '@azure/msal-browser';\nimport { silentAcquireToken, interactiveLogin } from './msalClient';\n\ninterface SessionMonitorProps {\n  monitoredScopes: string[];\n  refreshBeforeExpirySeconds?: number;\n  fallbackIntervalSeconds?: number;\n}\n\n// Global redirect guard to prevent multiple concurrent redirects\ndeclare global {\n  interface Window {\n    __isRedirectingToLogin?: boolean;\n  }\n}\n\nexport const SessionMonitor: React.FC<SessionMonitorProps> = ({\n  monitoredScopes,\n  refreshBeforeExpirySeconds = 60,\n  fallbackIntervalSeconds = 60,\n}) => {\n  const timeoutRef = useRef<NodeJS.Timeout | null>(null);\n  const isMountedRef = useRef(true);\n\n  const scheduleTokenRefresh = async () => {\n    if (!isMountedRef.current) return;\n\n    try {\n      console.log('[SessionMonitor] Checking token status...');\n      \n      // Attempt silent token acquisition to get current expiry\n      const tokenResponse = await silentAcquireToken(monitoredScopes);\n      \n      if (!isMountedRef.current) return;\n\n      const now = new Date();\n      const expiresOn = tokenResponse.expiresOn;\n      const refreshTime = new Date(expiresOn.getTime() - (refreshBeforeExpirySeconds * 1000));\n      \n      // If token expires very soon, refresh immediately\n      if (refreshTime <= now) {\n        console.log('[SessionMonitor] Token expires soon, refreshing immediately');\n        await performSilentRefresh();\n      } else {\n        // Schedule refresh before expiry\n        const timeUntilRefresh = refreshTime.getTime() - now.getTime();\n        console.log(`[SessionMonitor] Token valid until",
    "response": " ${expiresOn.toISOString()}, scheduling refresh at $",
    "language": "typescript",
    "filePath": "/response_6d92e7f1-c697-49f1-9494-e1267c8bcbf3/1",
    "accepted": true,
    "latency": 40,
    "modelName": "copilot",
    "lineNumber": 47,
    "characterCount": 52
  },
  {
    "id": "3d404712-5ba8-480e-ab37-9e75b0699fe0",
    "timestamp": 1763383267146,
    "type": "completion",
    "prompt": "import { useEffect, useRef } from 'react';\nimport { InteractionRequiredAuthError } from '@azure/msal-browser';\nimport { silentAcquireToken, interactiveLogin } from './msalClient';\n\ninterface SessionMonitorProps {\n  monitoredScopes: string[];\n  refreshBeforeExpirySeconds?: number;\n  fallbackIntervalSeconds?: number;\n}\n\n// Global redirect guard to prevent multiple concurrent redirects\ndeclare global {\n  interface Window {\n    __isRedirectingToLogin?: boolean;\n  }\n}\n\nexport const SessionMonitor: React.FC<SessionMonitorProps> = ({\n  monitoredScopes,\n  refreshBeforeExpirySeconds = 60,\n  fallbackIntervalSeconds = 60,\n}) => {\n  const timeoutRef = useRef<NodeJS.Timeout | null>(null);\n  const isMountedRef = useRef(true);\n\n  const scheduleTokenRefresh = async () => {\n    if (!isMountedRef.current) return;\n\n    try {\n      console.log('[SessionMonitor] Checking token status...');\n      \n      // Attempt silent token acquisition to get current expiry\n      const tokenResponse = await silentAcquireToken(monitoredScopes);\n      \n      if (!isMountedRef.current) return;\n\n      const now = new Date();\n      const expiresOn = tokenResponse.expiresOn;\n      const refreshTime = new Date(expiresOn.getTime() - (refreshBeforeExpirySeconds * 1000));\n      \n      // If token expires very soon, refresh immediately\n      if (refreshTime <= now) {\n        console.log('[SessionMonitor] Token expires soon, refreshing immediately');\n        await performSilentRefresh();\n      } else {\n        // Schedule refresh before expiry\n        const timeUntilRefresh = refreshTime.getTime() - now.getTime();\n        console.log(`[SessionMonitor] Token valid until ${expiresOn.toISOString()}, scheduling refresh at ${refreshTime.toISOString()}`);",
    "response": "\n        \n        timeoutRef.current",
    "language": "typescript",
    "filePath": "/response_6d92e7f1-c697-49f1-9494-e1267c8bcbf3/1",
    "accepted": true,
    "latency": 40,
    "modelName": "copilot",
    "lineNumber": 47,
    "characterCount": 36
  },
  {
    "id": "22459c56-b95a-4bf7-8f05-81cd7adcce98",
    "timestamp": 1763383267746,
    "type": "completion",
    "prompt": "\ninterface SessionMonitorProps {\n  monitoredScopes: string[];\n  refreshBeforeExpirySeconds?: number;\n  fallbackIntervalSeconds?: number;\n}\n\n// Global redirect guard to prevent multiple concurrent redirects\ndeclare global {\n  interface Window {\n    __isRedirectingToLogin?: boolean;\n  }\n}\n\nexport const SessionMonitor: React.FC<SessionMonitorProps> = ({\n  monitoredScopes,\n  refreshBeforeExpirySeconds = 60,\n  fallbackIntervalSeconds = 60,\n}) => {\n  const timeoutRef = useRef<NodeJS.Timeout | null>(null);\n  const isMountedRef = useRef(true);\n\n  const scheduleTokenRefresh = async () => {\n    if (!isMountedRef.current) return;\n\n    try {\n      console.log('[SessionMonitor] Checking token status...');\n      \n      // Attempt silent token acquisition to get current expiry\n      const tokenResponse = await silentAcquireToken(monitoredScopes);\n      \n      if (!isMountedRef.current) return;\n\n      const now = new Date();\n      const expiresOn = tokenResponse.expiresOn;\n      const refreshTime = new Date(expiresOn.getTime() - (refreshBeforeExpirySeconds * 1000));\n      \n      // If token expires very soon, refresh immediately\n      if (refreshTime <= now) {\n        console.log('[SessionMonitor] Token expires soon, refreshing immediately');\n        await performSilentRefresh();\n      } else {\n        // Schedule refresh before expiry\n        const timeUntilRefresh = refreshTime.getTime() - now.getTime();\n        console.log(`[SessionMonitor] Token valid until ${expiresOn.toISOString()}, scheduling refresh at ${refreshTime.toISOString()}`);\n        \n        timeoutRef.current = setTimeout(async () => {\n          if (isMountedRef.current) {\n            await performSilentRefresh();\n          }\n        },",
    "response": " timeUntilRefresh);\n      }",
    "language": "typescript",
    "filePath": "/response_6d92e7f1-c697-49f1-9494-e1267c8bcbf3/1",
    "accepted": true,
    "latency": 69,
    "modelName": "copilot",
    "lineNumber": 53,
    "characterCount": 27
  },
  {
    "id": "4603a2c0-5e53-49b4-a489-28a09d042d90",
    "timestamp": 1763383268195,
    "type": "completion",
    "prompt": "}\n\n// Global redirect guard to prevent multiple concurrent redirects\ndeclare global {\n  interface Window {\n    __isRedirectingToLogin?: boolean;\n  }\n}\n\nexport const SessionMonitor: React.FC<SessionMonitorProps> = ({\n  monitoredScopes,\n  refreshBeforeExpirySeconds = 60,\n  fallbackIntervalSeconds = 60,\n}) => {\n  const timeoutRef = useRef<NodeJS.Timeout | null>(null);\n  const isMountedRef = useRef(true);\n\n  const scheduleTokenRefresh = async () => {\n    if (!isMountedRef.current) return;\n\n    try {\n      console.log('[SessionMonitor] Checking token status...');\n      \n      // Attempt silent token acquisition to get current expiry\n      const tokenResponse = await silentAcquireToken(monitoredScopes);\n      \n      if (!isMountedRef.current) return;\n\n      const now = new Date();\n      const expiresOn = tokenResponse.expiresOn;\n      const refreshTime = new Date(expiresOn.getTime() - (refreshBeforeExpirySeconds * 1000));\n      \n      // If token expires very soon, refresh immediately\n      if (refreshTime <= now) {\n        console.log('[SessionMonitor] Token expires soon, refreshing immediately');\n        await performSilentRefresh();\n      } else {\n        // Schedule refresh before expiry\n        const timeUntilRefresh = refreshTime.getTime() - now.getTime();\n        console.log(`[SessionMonitor] Token valid until ${expiresOn.toISOString()}, scheduling refresh at ${refreshTime.toISOString()}`);\n        \n        timeoutRef.current = setTimeout(async () => {\n          if (isMountedRef.current) {\n            await performSilentRefresh();\n          }\n        }, timeUntilRefresh);\n      }\n    } catch (error) {\n      if (!isMountedRef.current) return;\n      \n      if (isInteractionRequiredError(error)) {",
    "response": "\n        console.log('[SessionMonitor]",
    "language": "typescript",
    "filePath": "/response_6d92e7f1-c697-49f1-9494-e1267c8bcbf3/1",
    "accepted": true,
    "latency": 50,
    "modelName": "copilot",
    "lineNumber": 58,
    "characterCount": 38
  },
  {
    "id": "b355d466-7032-4cca-a4c1-a8b78906ae84",
    "timestamp": 1763383268703,
    "type": "completion",
    "prompt": "declare global {\n  interface Window {\n    __isRedirectingToLogin?: boolean;\n  }\n}\n\nexport const SessionMonitor: React.FC<SessionMonitorProps> = ({\n  monitoredScopes,\n  refreshBeforeExpirySeconds = 60,\n  fallbackIntervalSeconds = 60,\n}) => {\n  const timeoutRef = useRef<NodeJS.Timeout | null>(null);\n  const isMountedRef = useRef(true);\n\n  const scheduleTokenRefresh = async () => {\n    if (!isMountedRef.current) return;\n\n    try {\n      console.log('[SessionMonitor] Checking token status...');\n      \n      // Attempt silent token acquisition to get current expiry\n      const tokenResponse = await silentAcquireToken(monitoredScopes);\n      \n      if (!isMountedRef.current) return;\n\n      const now = new Date();\n      const expiresOn = tokenResponse.expiresOn;\n      const refreshTime = new Date(expiresOn.getTime() - (refreshBeforeExpirySeconds * 1000));\n      \n      // If token expires very soon, refresh immediately\n      if (refreshTime <= now) {\n        console.log('[SessionMonitor] Token expires soon, refreshing immediately');\n        await performSilentRefresh();\n      } else {\n        // Schedule refresh before expiry\n        const timeUntilRefresh = refreshTime.getTime() - now.getTime();\n        console.log(`[SessionMonitor] Token valid until ${expiresOn.toISOString()}, scheduling refresh at ${refreshTime.toISOString()}`);\n        \n        timeoutRef.current = setTimeout(async () => {\n          if (isMountedRef.current) {\n            await performSilentRefresh();\n          }\n        }, timeUntilRefresh);\n      }\n    } catch (error) {\n      if (!isMountedRef.current) return;\n      \n      if (isInteractionRequiredError(error)) {\n        console.log('[SessionMonitor] No valid session found, triggering interactive login');\n        await handleInteractionRequired();\n      } else {",
    "response": "\n        console.warn('[SessionMonitor]",
    "language": "typescript",
    "filePath": "/response_6d92e7f1-c697-49f1-9494-e1267c8bcbf3/1",
    "accepted": true,
    "latency": 41,
    "modelName": "copilot",
    "lineNumber": 61,
    "characterCount": 39
  },
  {
    "id": "f137209e-bf32-427a-9077-92623fbda870",
    "timestamp": 1763383269126,
    "type": "completion",
    "prompt": "    __isRedirectingToLogin?: boolean;\n  }\n}\n\nexport const SessionMonitor: React.FC<SessionMonitorProps> = ({\n  monitoredScopes,\n  refreshBeforeExpirySeconds = 60,\n  fallbackIntervalSeconds = 60,\n}) => {\n  const timeoutRef = useRef<NodeJS.Timeout | null>(null);\n  const isMountedRef = useRef(true);\n\n  const scheduleTokenRefresh = async () => {\n    if (!isMountedRef.current) return;\n\n    try {\n      console.log('[SessionMonitor] Checking token status...');\n      \n      // Attempt silent token acquisition to get current expiry\n      const tokenResponse = await silentAcquireToken(monitoredScopes);\n      \n      if (!isMountedRef.current) return;\n\n      const now = new Date();\n      const expiresOn = tokenResponse.expiresOn;\n      const refreshTime = new Date(expiresOn.getTime() - (refreshBeforeExpirySeconds * 1000));\n      \n      // If token expires very soon, refresh immediately\n      if (refreshTime <= now) {\n        console.log('[SessionMonitor] Token expires soon, refreshing immediately');\n        await performSilentRefresh();\n      } else {\n        // Schedule refresh before expiry\n        const timeUntilRefresh = refreshTime.getTime() - now.getTime();\n        console.log(`[SessionMonitor] Token valid until ${expiresOn.toISOString()}, scheduling refresh at ${refreshTime.toISOString()}`);\n        \n        timeoutRef.current = setTimeout(async () => {\n          if (isMountedRef.current) {\n            await performSilentRefresh();\n          }\n        }, timeUntilRefresh);\n      }\n    } catch (error) {\n      if (!isMountedRef.current) return;\n      \n      if (isInteractionRequiredError(error)) {\n        console.log('[SessionMonitor] No valid session found, triggering interactive login');\n        await handleInteractionRequired();\n      } else {\n        console.warn('[SessionMonitor] Initial token check failed, retrying in fallback interval:', error);\n        //",
    "response": " Schedule retry for transient errors\n        timeoutRef.current = setTimeout(() => {\n          if (isMountedRef.current) {\n            scheduleTokenRefresh();\n          }\n        }, fallbackIntervalSeconds * 1000);\n      }\n    }\n  };\n\n  const performSilentRefresh = async () => {\n    if (!isMountedRef.current) return;\n\n    try {\n      console.log('[SessionMonitor] Performing silent token refresh...');\n      const tokenResponse = await silentAcquireToken(monitoredScopes);\n      \n      if (!isMountedRef.current) return;\n      \n      console.log('[SessionMonitor] Silent refresh successful, token valid until:', tokenResponse.expiresOn.toISOString());\n      \n      // Schedule next refresh\n      const now = new Date();\n      const nextRefreshTime = new Date(tokenResponse.expiresOn.getTime() - (refreshBeforeExpirySeconds * 1000));\n      const timeUntilNextRefresh = nextRefreshTime.getTime() - now.getTime();\n      \n      if (timeUntilNextRefresh > 0) {\n        timeoutRef.current = setTimeout(() => {\n          if (isMountedRef.current) {\n            performSilentRefresh();\n          }\n        }, timeUntilNextRefresh);\n      }\n    } catch (error) {\n      if (!isMountedRef.current) return;\n      \n      if (isInteractionRequiredError(error)) {\n        console.log('[SessionMonitor] Silent refresh failed - interaction required, triggering redirect');\n        await handle",
    "language": "typescript",
    "filePath": "/response_6d92e7f1-c697-49f1-9494-e1267c8bcbf3/1",
    "accepted": true,
    "latency": 11,
    "modelName": "copilot",
    "lineNumber": 63,
    "characterCount": 1378
  },
  {
    "id": "e076aab3-1678-4d02-9ab9-23c488b4c3f0",
    "timestamp": 1763401260191,
    "type": "completion",
    "prompt": "",
    "response": "from fastapi import FastAPI, Depends, HTTPException, status, Request\nfrom fastapi.responses import JSONResponse\nfrom fastapi.security import HTTPBearer, HTTPAuthorizationCredentials\nfrom fastapi.middleware.cors import CORSMiddleware\nfrom typing import Dict, Any\nimport logging\nfrom auth import verify_jwt, has_required_role\n\n# Configure logging\nlogging.basicConfig(level=logging.INFO)\nlogger = logging.getLogger(__name__)\n\n# Create FastAPI app\napp = FastAPI(\n    title=\"Microsoft Entra ID JWT Auth API\",\n    description=\"A minimal FastAPI application with Microsoft Entra (Azure AD) JWT validation\",\n    version=\"1.0.0\"\n)\n\n# CORS - allow the SPA dev server to call the API\napp.add_middleware(\n    CORSMiddleware,\n    allow_origins=[\"http://localhost:5173\"],  # or [\"*\"] for dev convenience\n    allow_credentials=True,\n    allow_methods=[\"*\"],\n    allow_headers=[\"*\"],\n)\n\n# Simple request logger middleware to confirm requests reach backend\n@app.middleware(\"http\")\nasync def log_requests(request: Request, call_next):\n    logger.info(f\"Incoming request: {request.method} {request.url.path} from {request.client.host}\")\n    # Optionally log Authorization header presence (do not log token contents in prod)\n    if \"authorization\" in request.headers:\n        logger.info(\"Authorization header present\")\n    response = await call_next(request)\n    logger.info(f\"Response status: {response.status_code} for {request.method} {request.url.path}\")\n    return response\n\n# Security scheme for Bearer token\nsecurity = HTTPBearer()\n\nasync def get_current_user(credentials: HTTPAuthorizationCredentials = Depends(security)) -> Dict[str, Any]:\n    if not credentials or not credentials.credentials:\n        raise HTTPException(\n            status_code=status.HTTP_401_UNAUTHORIZED,\n            detail=\"Authorization header missing or invalid\",\n            headers={\"WWW-Authenticate\": \"Bearer\"},\n        )\n\n    token = credentials.credentials\n\n    try:\n        claims = await verify_jwt(token)\n        # Use preferred_username/email if available -- good for logs\n        logger.info(f\"Successfully authenticated user: {claims.get('preferred_username', 'unknown')}\")\n        return claims\n\n    except Exception as e:\n        logger.error(f\"Token verification failed: {str(e)}\")\n        raise HTTPException(\n            status_code=status.HTTP_401_UNAUTHORIZED,\n            detail=\"Token validation failed\",\n            headers={\"WWW-Authenticate\": \"Bearer\"},\n        )\n\nasync def require_approver_role(current_user: Dict[str, Any] = Depends(get_current_user)) -> Dict[str, Any]:\n    if not has_required_role(current_user, \"approver\"):\n        raise HTTPException(\n            status_code=status.HTTP_403_FORBIDDEN,\n            detail=\"Access denied: 'approver' role required\"\n        )\n    return current_user\n\n@app.get(\"/health\")\nasync def health_check():\n    return {\"ok\": True}\n\n@app.get(\"/api/profile\")\nasync def get_profile(current_user: Dict[str, Any] = Depends(get_current_user)):\n    \"\"\"\n    Protected endpoint that decodes and returns the bearer token claims.\n    Simply returns the raw JWT claims without any processing.\n    \"\"\"\n    return current_user\n\n@app.get(\"/api/admin-only\")\nasync def admin_only_endpoint(current_user: Dict[str, Any] = Depends(require_approver_role)):\n    return {\n        \"message\": \"Welcome to the admin area!\",\n        \"user\": {\n            \"email\": current_user.get(\"email\") or current_user.get(\"preferred_username\"),\n            \"name\": current_user.get(\"name\"),\n            \"roles\": current_user.get(\"roles\", [])\n        },\n        \"admin_info\": {\n            \"access_level\": \"administrator\",\n            \"permissions\": [\"read\", \"write\", \"delete\", \"approve\"]\n        }\n    }\n\n@app.exception_handler(Exception)\nasync def global_exception_handler(request: Request, exc: Exception):\n    logger.exception(f\"Unhandled exception for {request.method} {request.url.path}: {exc}\")\n    return JSONResponse(\n        status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n        content={\"detail\": \"Internal server error\"}\n    )\n\nif __name__ == \"__main__\":\n    import uvicorn\n    uvicorn.run(app, host=\"0.0.0.0\", port=8000, reload=True)\n",
    "language": "python",
    "filePath": "/Users/madhveshs/Documents/Work/apike-sso-backend/main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 4147
  },
  {
    "id": "61bcbe31-77c7-4a68-bfb6-3abc2e9df1e8",
    "timestamp": 1763404339229,
    "type": "completion",
    "prompt": "",
    "response": "sso-spike.onrender.com\",  # Production frontend\n        \"http://",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 22,
    "characterCount": 64
  },
  {
    "id": "306c9e24-6106-49a9-8091-97515e975fc2",
    "timestamp": 1763404373389,
    "type": "completion",
    "prompt": "",
    "response": "from fastapi import FastAPI, Depends, HTTPException, status, Request\nfrom fastapi.responses import JSONResponse\nfrom fastapi.security import HTTPBearer, HTTPAuthorizationCredentials\nfrom fastapi.middleware.cors import CORSMiddleware\nfrom typing import Dict, Any\nimport logging\nfrom auth import verify_jwt, has_required_role\n\n# Configure logging\nlogging.basicConfig(level=logging.INFO)\nlogger = logging.getLogger(__name__)\n\n# Create FastAPI app\napp = FastAPI(\n    title=\"Microsoft Entra ID JWT Auth API\",\n    description=\"A minimal FastAPI application with Microsoft Entra (Azure AD) JWT validation\",\n    version=\"1.0.0\"\n)\n\n# CORS - allow both production and local development origins\napp.add_middleware(\n    CORSMiddleware,\n    allow_origins=[\n        \"https://sso-spike.onrender.com\",  # Production frontend\n        \"http://localhost:5173\",          # Local Vite dev server\n        \"http://localhost:3000\",          # Alternative local port\n    ],\n    allow_credentials=True,\n    allow_methods=[\"GET\", \"POST\", \"PUT\", \"DELETE\", \"OPTIONS\"],\n    allow_headers=[\"Authorization\", \"Content-Type\", \"Accept\"],\n)\n\n# Simple request logger middleware to confirm requests reach backend\n@app.middleware(\"http\")\nasync def log_requests(request: Request, call_next):\n    logger.info(f\"Incoming request: {request.method} {request.url.path} from {request.client.host}\")\n    # Optionally log Authorization header presence (do not log token contents in prod)\n    if \"authorization\" in request.headers:\n        logger.info(\"Authorization header present\")\n    response = await call_next(request)\n    logger.info(f\"Response status: {response.status_code} for {request.method} {request.url.path}\")\n    return response\n\n# Security scheme for Bearer token\nsecurity = HTTPBearer()\n\nasync def get_current_user(credentials: HTTPAuthorizationCredentials = Depends(security)) -> Dict[str, Any]:\n    if not credentials or not credentials.credentials:\n        raise HTTPException(\n            status_code=status.HTTP_401_UNAUTHORIZED,\n            detail=\"Authorization header missing or invalid\",\n            headers={\"WWW-Authenticate\": \"Bearer\"},\n        )\n\n    token = credentials.credentials\n\n    try:\n        claims = await verify_jwt(token)\n        # Use preferred_username/email if available -- good for logs\n        logger.info(f\"Successfully authenticated user: {claims.get('preferred_username', 'unknown')}\")\n        return claims\n\n    except Exception as e:\n        logger.error(f\"Token verification failed: {str(e)}\")\n        raise HTTPException(\n            status_code=status.HTTP_401_UNAUTHORIZED,\n            detail=\"Token validation failed\",\n            headers={\"WWW-Authenticate\": \"Bearer\"},\n        )\n\nasync def require_approver_role(current_user: Dict[str, Any] = Depends(get_current_user)) -> Dict[str, Any]:\n    if not has_required_role(current_user, \"approver\"):\n        raise HTTPException(\n            status_code=status.HTTP_403_FORBIDDEN,\n            detail=\"Access denied: 'approver' role required\"\n        )\n    return current_user\n\n@app.get(\"/health\")\nasync def health_check():\n    return {\"ok\": True}\n\n@app.get(\"/api/profile\")\nasync def get_profile(current_user: Dict[str, Any] = Depends(get_current_user)):\n    \"\"\"\n    Protected endpoint that decodes and returns the bearer token claims.\n    Simply returns the raw JWT claims without any processing.\n    \"\"\"\n    return current_user\n\n@app.get(\"/api/admin-only\")\nasync def admin_only_endpoint(current_user: Dict[str, Any] = Depends(require_approver_role)):\n    return {\n        \"message\": \"Welcome to the admin area!\",\n        \"user\": {\n            \"email\": current_user.get(\"email\") or current_user.get(\"preferred_username\"),\n            \"name\": current_user.get(\"name\"),\n            \"roles\": current_user.get(\"roles\", [])\n        },\n        \"admin_info\": {\n            \"access_level\": \"administrator\",\n            \"permissions\": [\"read\", \"write\", \"delete\", \"approve\"]\n        }\n    }\n\n@app.exception_handler(Exception)\nasync def global_exception_handler(request: Request, exc: Exception):\n    logger.exception(f\"Unhandled exception for {request.method} {request.url.path}: {exc}\")\n    return JSONResponse(\n        status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n        content={\"detail\": \"Internal server error\"}\n    )\n\nif __name__ == \"__main__\":\n    import uvicorn\n    uvicorn.run(app, host=\"0.0.0.0\", port=8000, reload=True)\n",
    "language": "python",
    "filePath": "/Users/madhveshs/Documents/Work/apike-sso-backend/main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 0,
    "characterCount": 4382
  },
  {
    "id": "1deeb05a-7cdb-4d26-a3c9-953042a60d29",
    "timestamp": 1763404378365,
    "type": "completion",
    "prompt": "",
    "response": "# CORS - allow both production and local development origins\napp.add_middleware(\n    CORSMiddleware,\n    allow_origins=[\n        \"https://sso-spike.onrender.com\",  # Production frontend\n        \"http://localhost:5173\",          # Local Vite dev server\n        \"http://localhost:3000\",          # Alternative local port\n    ],\n    allow_credentials=True,\n    allow_methods=[\"GET\", \"POST\", \"PUT\", \"DELETE\", \"OPTIONS\"],\n    allow_headers=[\"Authorization\", \"Content-Type\", \"Accept\"],\n",
    "language": "plaintext",
    "filePath": "/Users/madhveshs/Documents/Work/apike-sso-backend/main.py.git",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 19,
    "characterCount": 480
  },
  {
    "id": "66b48933-51c2-404c-9cdf-c99faad70385",
    "timestamp": 1763404384111,
    "type": "completion",
    "prompt": "",
    "response": "# CORS - allow both production and local development origins\napp.add_middleware(\n    CORSMiddleware,\n    allow_origins=[\n        \"https://sso-spike.onrender.com\",  # Production frontend\n        \"http://localhost:5173\",          # Local Vite dev server\n        \"http://localhost:3000\",          # Alternative local port\n    ],\n    allow_credentials=True,\n    allow_methods=[\"GET\", \"POST\", \"PUT\", \"DELETE\", \"OPTIONS\"],\n    allow_headers=[\"Authorization\", \"Content-Type\", \"Accept\"],\n",
    "language": "plaintext",
    "filePath": "/Users/madhveshs/Documents/Work/apike-sso-backend/main.py.git",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 19,
    "characterCount": 480
  },
  {
    "id": "d6e20f5b-5abb-4008-8679-3f7d5ad744c6",
    "timestamp": 1763541336254,
    "type": "completion",
    "prompt": "    logger.info(f\"Response status: {response.status_code} for {request.method} {request.url.path}\")\n    return response\n\n# Security scheme for Bearer token\nsecurity = HTTPBearer()\n\nasync def get_current_user(credentials: HTTPAuthorizationCredentials = Depends(security)) -> Dict[str, Any]:\n    if not credentials or not credentials.credentials:\n        raise HTTPException(\n            status_code=status.HTTP_401_UNAUTHORIZED,\n            detail=\"Authorization header missing or invalid\",\n            headers={\"WWW-Authenticate\": \"Bearer\"},\n        )\n\n    token = credentials.credentials\n\n    try:\n        claims = await verify_jwt(token)\n        # Use preferred_username/email if available -- good for logs\n        logger.info(f\"Successfully authenticated user: {claims.get('preferred_username', 'unknown')}\")\n        return claims\n\n    except Exception as e:\n        logger.error(f\"Token verification failed: {str(e)}\")\n        raise HTTPException(\n            status_code=status.HTTP_401_UNAUTHORIZED,\n            detail=\"Token validation failed\",\n            headers={\"WWW-Authenticate\": \"Bearer\"},\n        )\n\nasync def require_approver_role(current_user: Dict[str, Any] = Depends(get_current_user)) -> Dict[str, Any]:\n    if not has_required_role(current_user, \"approver\"):\n        raise HTTPException(\n            status_code=status.HTTP_403_FORBIDDEN,\n            detail=\"Access denied: 'approver' role required\"\n        )\n    return current_user\n\n@app.get(\"/health\")\nasync def health_check():\n    return {\"ok\": True}\n\n@app.get(\"/api/profile\")\nasync def get_profile(current_user: Dict[str, Any] = Depends(get_current_user)):\n    \"\"\"\n    Protected endpoint that decodes and returns the bearer token claims.\n    Simply returns the raw JWT claims without any processing.\n    \"\"\"\n    return current_user\n\n",
    "response": "@app.get(\"/api/admin-only\")\nasync def admin_only_endpoint(current_user: Dict[str, Any] = Depends(require_approver_role)):\n    return {\n        \"message\": \"Welcome to the admin area!\",\n        \"user\": {\n            \"email\": current_user.get(\"email\") or current_user.get(\"preferred_username\"),\n            \"name\": current_user.get(\"name\"),\n            \"roles\": current_user.get(\"roles\", [])\n        },\n        \"admin_info\": {\n            \"access_level\": \"administrator\",\n            \"permissions\": [\"read\", \"write\", \"delete\", \"approve\"]\n        }\n    }",
    "language": "python",
    "filePath": "main.py",
    "accepted": true,
    "latency": 530,
    "modelName": "copilot",
    "lineNumber": 90,
    "characterCount": 550
  },
  {
    "id": "595ef0bf-6e98-4510-95a8-6ee08d65cea1",
    "timestamp": 1763541336259,
    "type": "completion",
    "prompt": "",
    "response": "@app.get(\"/api/admin-only\")\nasync def admin_only_endpoint(current_user: Dict[str, Any] = Depends(require_approver_role)):\n    return {\n        \"message\": \"Welcome to the admin area!\",\n        \"user\": {\n            \"email\": current_user.get(\"email\") or current_user.get(\"preferred_username\"),\n            \"name\": current_user.get(\"name\"),\n            \"roles\": current_user.get(\"roles\", [])\n        },\n        \"admin_info\": {\n            \"access_level\": \"administrator\",\n            \"permissions\": [\"read\", \"write\", \"delete\", \"approve\"]\n        }\n    }",
    "language": "python",
    "filePath": "/Users/madhveshs/Documents/Work/apike-sso-backend/main.py",
    "accepted": true,
    "latency": 0,
    "modelName": "copilot",
    "lineNumber": 90,
    "characterCount": 550
  }
]